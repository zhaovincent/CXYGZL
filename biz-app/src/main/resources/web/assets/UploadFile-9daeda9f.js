import{d as V,r as v,L as U,a as p,c as w,a5 as _,w as y,a3 as A,f as x,as as b,k as B,R as I,a7 as R,aB as S,h as z,l as h}from"./index-e01dade3.js";import{E as F}from"./el-dialog-1471a1af.js";import{E as N}from"./el-progress-be452bc9.js";import{u as O,d as q}from"./index-f7c9196e.js";const C=["src"],M=V({__name:"MultiUploadFile",props:{disabled:{type:Boolean,default:!1},modelValue:{type:Array,default:[]},limit:{type:Number,default:10},maxSize:{type:Number,default:10}},emits:["update:modelValue"],setup(o,{emit:m}){const s=o,c=v(""),l=v(!1),a=v([]);U(()=>s.modelValue,e=>{const t=a.value.map(r=>r.url);t.length>0&&t.length===e.length&&t.every(r=>e.some(n=>n===r))&&e.every(r=>t.some(n=>n===r))||(a.value=e.map(r=>({url:r.url,name:r.name})))},{immediate:!0});async function u(e){console.log(e);const{data:t}=await O(e.file),r=a.value.findIndex(n=>n.uid==e.file.uid);a.value.splice(r,1,{name:e.file.name,url:t}),m("update:modelValue",a.value.map(n=>({url:n.url,name:n.name})))}function f(e){const t=e.url;t&&q(t).then(()=>{m("update:modelValue",a.value.map(r=>({url:r.url,name:r.name})))})}function d(e){return e.size>s.maxSize*1048*1048?(R.warning("上传文件不能大于"+s.maxSize+"M"),!1):!0}const i=e=>{c.value=e.url,l.value=!0};return(e,t)=>{const r=S,n=N,E=F;return p(),w(I,null,[_(n,{"file-list":x(a),"onUpdate:fileList":t[0]||(t[0]=g=>b(a)?a.value=g:null),"before-upload":d,"http-request":u,"on-remove":f,"on-preview":i,limit:s.limit,disabled:o.disabled},{default:y(()=>[_(r,{type:"primary"},{default:y(()=>[A("选择文件")]),_:1})]),_:1},8,["file-list","limit","disabled"]),_(E,{modelValue:x(l),"onUpdate:modelValue":t[1]||(t[1]=g=>b(l)?l.value=g:null)},{default:y(()=>[B("img",{"w-full":"",src:x(c),alt:"Preview Image"},null,8,C)]),_:1},8,["modelValue"])],64)}}}),j=V({__name:"UploadFile",props:{mode:{type:String,default:"D"},form:{type:Object,default:()=>{}}},setup(o,{expose:m}){const s=o;return z(),m({getValidateRule:()=>{var l=s.form,a=(f,d,i)=>{if(l.required&&d.length==0)return i(new Error("请上传"+l.name));if(d.length==0)return i();if(l.props.min&&d.length<l.props.min)return i(new Error("上传数量不能小于"+l.props.min));if(l.props.suffixArray&&l.props.suffixArray.length>0)for(var e of d){let r=e.name;var t=r.substring(r.lastIndexOf(".")+1);if(l.props.suffixArray.indexOf(t)<0)return i(new Error("文件只支持"+l.props.suffixArray+"格式"))}return i()};let u=[{validator:a,trigger:"blur"}];return l.required&&u.push({required:!0,message:"请上传"+l.name,trigger:"blur"}),u}}),(l,a)=>{const u=M;return p(),w("div",null,[o.mode==="D"?(p(),h(u,{key:0,disabled:!0})):(p(),h(u,{key:1,modelValue:o.form.props.value,"onUpdate:modelValue":a[0]||(a[0]=f=>o.form.props.value=f),disabled:o.form.perm==="R"},null,8,["modelValue","disabled"]))])}}}),T=Object.freeze(Object.defineProperty({__proto__:null,default:j},Symbol.toStringTag,{value:"Module"}));export{T as _};
