import{D as g,h as Y,r as Z,L as j,a as i,l as V,w as d,a5 as r,f as l,c as m,R as f,a6 as x,a3 as _,q as ee,am as y,as as O,k as p}from"./index-e01dade3.js";import{E as le}from"./el-drawer-51597e24.js";import{E as te,a as oe}from"./el-tab-pane-5b128a44.js";import{E as ae}from"./el-input-number-182b17d2.js";import"./el-tag-929563f7.js";import{E as re,a as se}from"./el-select-c154265f.js";import"./el-scrollbar-f2029ad1.js";import"./el-popper-ee5283d6.js";import{E as de}from"./el-divider-84ed2554.js";import{E as ne,a as ue}from"./el-radio-70657465.js";import{a as ie,E as pe}from"./el-row-e9611a44.js";import{$ as me}from"./index-126d0406.js";import{s as fe}from"./const-36faa2f4.js";import{u as _e}from"./index-219f5c7e.js";import{u as ve}from"./flow-2349aa77.js";import ye from"./formPerm-7089267e.js";import{_ as F}from"./selectAndShow.vue_vue_type_script_setup_true_lang-a708354f.js";import"./el-dialog-1471a1af.js";import"./refs-dd65b3fd.js";import"./strings-6464b592.js";import"./index-f7c59abe.js";import"./isEqual-47390e81.js";import"./_Uint8Array-aeb50f83.js";import"./debounce-bf37b7f7.js";import"./index-6b517de5.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./employeesDialog-3166dde1.js";import"./selectBox-a8819872.js";import"./el-avatar-63a3488d.js";import"./el-checkbox-123bf6dd.js";import"./flatten-178b99bc.js";import"./_baseFlatten-6e5398bc.js";import"./_overRest-a79e0547.js";/* empty css                */import"./index-8f0c79b2.js";import"./selectResult-ca10c7f8.js";import"./orgItem-da1d9713.js";const ge=p("h4",null,"选择角色",-1),ce=p("h4",null,"选择成员",-1),be=p("h4",null,"部门控件",-1),Ue=p("h4",null,"人员控件",-1),Ve=p("h4",null,"审批终点",-1),Le=p("span",{style:{"margin-right":"5px","font-size":"14px"}},"到第",-1),Te=p("span",{style:{"margin-left":"5px","font-size":"14px"}},"级部门主管终止",-1),he=p("h4",null,"选择方式",-1),Ee=p("h4",null,"多人审批时采用的审批方式",-1),ke={style:{display:"block",width:"100%"}},Ne={style:{display:"block",width:"100%"}},ze={style:{display:"block",width:"100%"}},we=p("h4",null,"指定审批层级",-1),xe=p("span",{style:{"margin-right":"5px","font-size":"14px"}},"第",-1),De=p("span",{style:{"margin-left":"5px","font-size":"14px"}},"级部门主管",-1),Se=p("h4",null,"审批人为空时",-1),Ce=p("h4",null,"审批被拒绝",-1),cl={__name:"approverDrawer",setup(Ie){let P=ve();var k=g({get(){return e.value.formUserId},set(s){e.value.formUserId=s,e.value.formUserName=B.value.filter(t=>t.id===s)[0].name}}),q=g(()=>{let s=[];const t=[1];var a={},n={};N(void 0,P.step3,a,n,!0);var v=a[e.value.id];if(v==null)return[];for(var u of v){var b=n[u].type;t.indexOf(b)>-1&&n[u].id!=e.value.id&&s.push({id:n[u].id,name:n[u].nodeName})}return s});function N(s,t,a,n,v){if(L.$isNode(t)){var u=t.id;if(n[u]=t,L.$isNotBlank(s)){var E=a[s];let c=n[s].type;if((c==5||c==8)&&!v)a[u]=[];else{var T=L.$deepCopy(E);T.push(u),a[u]=T}}else{var b=[];b.push(u),a[u]=b}var h=t.type,U=t.childNode;if(h===5||h===8||h===4){var I=t.conditionNodes;for(var R of I)N(u,R,a,n,!1);L.$isNode(U)&&N(u,U,a,n,!0)}else L.$isNode(U)&&N(u,U,a,n,!0)}}const D=g(()=>P.step2),S=g(()=>D.value.filter(s=>s.type==="SelectUser"||s.type==="SelectMultiUser")),B=g(()=>D.value.filter(s=>s.type==="SelectDept"||s.type==="SelectMultiDept")),G=()=>{let s=D.value;var t={};let a=e.value.formPerms;for(var n of s)if(t[n.id]="R",n.type==="Layout"&&(t[n.id]="E"),a[n.id]&&(t[n.id]=a[n.id]),n.type==="Layout"){let u=n.props.value;for(var v of u)t[v.id]="R",a[v.id]&&(t[v.id]=a[v.id])}e.value.formPerms=t},{proxy:L}=Y();let e=Z({}),C=_e(),{setApproverConfig:A,setApprover:H}=C,M=g(()=>C.approverConfigData),J=g(()=>C.approverDrawer),z=g({get(){return J.value},set(){$()}});j(M,s=>{e.value=s.value});const K=s=>L.$isBlank(s)?!1:S.value.filter(a=>a.id===s)[0].props.multi;var w=g({get(){return e.value.formUserId},set(s){e.value.formUserName=S.value.filter(t=>t.id===s)[0].name,e.value.formUserId=s}});const Q=s=>{e.value.nodeUserList=[],e.value.formUserId="",e.value.formUserName=""},W=()=>{e.value.error=!me.checkApproval(e.value),A({value:e.value,flag:!0,id:M.value.id}),$()},$=()=>{H(!1)};return(s,t)=>{const a=ne,n=ie,v=pe,u=ue,b=de,E=re,T=se,h=ae,U=te,I=oe,R=le;return i(),V(R,{modelValue:l(z),"onUpdate:modelValue":t[13]||(t[13]=c=>O(z)?z.value=c:z=c),"append-to-body":!0,title:"审批人设置","show-close":!1,size:550,"before-close":W,onOpen:G},{default:d(()=>[r(I,{type:"border-card"},{default:d(()=>[r(U,{label:"设置审批人"},{default:d(()=>{var c;return[r(u,{modelValue:l(e).assignedType,"onUpdate:modelValue":t[0]||(t[0]=o=>l(e).assignedType=o),class:"ml-4",onChange:Q},{default:d(()=>[r(v,null,{default:d(()=>[(i(!0),m(f,null,x(l(fe),({value:o,label:X})=>(i(),V(n,{key:o,span:8},{default:d(()=>[r(a,{label:o},{default:d(()=>[_(ee(X),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"]),r(b),l(e).assignedType===3?(i(),m(f,{key:0},[ge,r(F,{orgList:l(e).nodeUserList,"onUpdate:orgList":t[1]||(t[1]=o=>l(e).nodeUserList=o),type:"role",multiple:!0},null,8,["orgList"])],64)):y("",!0),l(e).assignedType===1?(i(),m(f,{key:1},[ce,r(F,{orgList:l(e).nodeUserList,"onUpdate:orgList":t[2]||(t[2]=o=>l(e).nodeUserList=o),type:"user",multiple:!0},null,8,["orgList"])],64)):y("",!0),l(e).assignedType===9?(i(),m(f,{key:2},[be,r(T,{modelValue:l(k),"onUpdate:modelValue":t[3]||(t[3]=o=>O(k)?k.value=o:k=o),clearable:"",class:"m-2",placeholder:"请选择审批表单",size:"large"},{default:d(()=>[(i(!0),m(f,null,x(B.value,o=>(i(),V(E,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])],64)):y("",!0),l(e).assignedType===8?(i(),m(f,{key:3},[Ue,r(T,{modelValue:l(w),"onUpdate:modelValue":t[4]||(t[4]=o=>O(w)?w.value=o:w=o),clearable:"",class:"m-2",placeholder:"请选择审批表单",size:"large"},{default:d(()=>[(i(!0),m(f,null,x(S.value,o=>(i(),V(E,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])],64)):y("",!0),l(e).assignedType===7?(i(),m(f,{key:4},[Ve,Le,r(h,{modelValue:l(e).deptLeaderLevel,"onUpdate:modelValue":t[5]||(t[5]=o=>l(e).deptLeaderLevel=o),step:1,min:1,max:20,"step-strictly":"",size:"small"},null,8,["modelValue"]),Te],64)):y("",!0),l(e).assignedType===4?(i(),m(f,{key:5},[he,r(u,{modelValue:l(e).multiple,"onUpdate:modelValue":t[6]||(t[6]=o=>l(e).multiple=o),class:"ml-4"},{default:d(()=>[r(a,{label:!1,size:"large"},{default:d(()=>[_("单选")]),_:1}),r(a,{label:!0,size:"large"},{default:d(()=>[_("多选")]),_:1})]),_:1},8,["modelValue"])],64)):y("",!0),(l(e).multiple===!0&&l(e).assignedType===4||l(e).assignedType===9||l(e).assignedType===1&&l(e).nodeUserList.length>1||l(e).assignedType===3||l(e).assignedType===7&&l(e).deptLeaderLevel>1||l(e).assignedType===8&&K(l(e).formUserId))&&l(e).assignedType!=5&&l(e).assignedType!=2?(i(),m(f,{key:6},[Ee,r(u,{modelValue:l(e).multipleMode,"onUpdate:modelValue":t[7]||(t[7]=o=>l(e).multipleMode=o),class:"ml-4"},{default:d(()=>[p("p",ke,[r(a,{label:1,size:"large"},{default:d(()=>[_("会签(需要所有审批人同意)")]),_:1})]),p("p",Ne,[r(a,{label:2,size:"large"},{default:d(()=>[_("或签(一名审批人同意即可)")]),_:1})]),p("p",ze,[r(a,{label:3,size:"large"},{default:d(()=>[_("依次审批(按顺序依次审批)")]),_:1})])]),_:1},8,["modelValue"])],64)):y("",!0),l(e).assignedType===2?(i(),m(f,{key:7},[we,xe,r(h,{modelValue:l(e).deptLeaderLevel,"onUpdate:modelValue":t[8]||(t[8]=o=>l(e).deptLeaderLevel=o),step:1,min:1,max:20,"step-strictly":"",size:"small"},null,8,["modelValue"]),De],64)):y("",!0),r(b),Se,r(u,{modelValue:l(e).nobody.handler,"onUpdate:modelValue":t[9]||(t[9]=o=>l(e).nobody.handler=o),class:"ml-4"},{default:d(()=>[r(a,{label:"TO_PASS",size:"large"},{default:d(()=>[_("自动通过")]),_:1}),r(a,{label:"TO_REFUSE",size:"large"},{default:d(()=>[_("自动拒绝")]),_:1}),r(a,{label:"TO_ADMIN",size:"large"},{default:d(()=>[_("转交给管理员")]),_:1}),r(a,{label:"TO_USER",size:"large"},{default:d(()=>[_("指定人员")]),_:1})]),_:1},8,["modelValue"]),l(e).nobody.handler==="TO_USER"?(i(),V(F,{key:8,orgList:l(e).nobody.assignedUser,"onUpdate:orgList":t[10]||(t[10]=o=>l(e).nobody.assignedUser=o),type:"user",multiple:!1},null,8,["orgList"])):y("",!0),(c=l(e).refuse)!=null&&c.handler?(i(),m(f,{key:9},[Ce,r(u,{modelValue:l(e).refuse.handler,"onUpdate:modelValue":t[11]||(t[11]=o=>l(e).refuse.handler=o),class:"ml-4"},{default:d(()=>[r(a,{label:"TO_END",size:"large"},{default:d(()=>[_("直接结束流程")]),_:1}),r(a,{label:"TO_NODE",size:"large"},{default:d(()=>[_("驳回到指定节点")]),_:1})]),_:1},8,["modelValue"]),l(e).refuse.handler==="TO_NODE"?(i(),V(T,{key:0,modelValue:l(e).refuse.nodeId,"onUpdate:modelValue":t[12]||(t[12]=o=>l(e).refuse.nodeId=o),placeholder:"驳回节点",style:{width:"100%","margin-bottom":"20px"}},{default:d(()=>[(i(!0),m(f,null,x(l(q),o=>(i(),V(E,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):y("",!0)],64)):y("",!0)]}),_:1}),r(U,{label:"表单权限"},{default:d(()=>[r(ye,{"form-perm":l(e).formPerms},null,8,["form-perm"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}};export{cl as default};
