import{a as S,E as w,s as F}from"./el-select-c154265f.js";import{_ as M}from"./el-tree-5fcea156.js";import{u as $,t as H,D as C,a0 as O,d as L,h as z,L as I,c$ as x,cN as D,j as R,r as P,K as p,o as U,N as A,_ as W}from"./index-e01dade3.js";import{p as V}from"./el-checkbox-123bf6dd.js";import{i as G}from"./isEqual-47390e81.js";const J=(e,{attrs:c},{tree:d,key:u})=>{const o=$("tree-select"),n={...V(H(e),Object.keys(S.props)),...c,valueKey:u,popperClass:C(()=>{const s=[o.e("popper")];return e.popperClass&&s.push(e.popperClass),s.join(" ")}),filterMethod:(s="")=>{e.filterMethod&&e.filterMethod(s),O(()=>{var h;(h=d.value)==null||h.filter(s)})},onVisibleChange:s=>{var h;(h=c.onVisibleChange)==null||h.call(c,s),e.filterable&&s&&n.filterMethod()}};return n},Q=L({extends:w,setup(e,c){const d=w.setup(e,c);delete d.selectOptionClick;const u=z().proxy;return O(()=>{d.select.cachedOptions.get(u.value)||d.select.onOptionCreate(u)}),d},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function T(e){return e||e===0}function j(e){return Array.isArray(e)&&e.length}function N(e){return Array.isArray(e)?e:T(e)?[e]:[]}function E(e,c,d,u,o){for(let n=0;n<e.length;n++){const s=e[n];if(c(s,n,e,o))return u?u(s,n,e,o):s;{const h=d(s);if(j(h)){const a=E(h,c,d,u,s);if(a)return a}}}}function q(e,c,d,u){for(let o=0;o<e.length;o++){const n=e[o];c(n,o,e,u);const s=d(n);j(s)&&q(s,c,d,n)}}const X=(e,{attrs:c,slots:d,emit:u},{select:o,tree:n,key:s})=>{I(()=>e.modelValue,()=>{e.showCheckbox&&O(()=>{const t=n.value;t&&!G(t.getCheckedKeys(),N(e.modelValue))&&t.setCheckedKeys(N(e.modelValue))})},{immediate:!0,deep:!0});const h=C(()=>({value:s.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),a=(t,l)=>{var i;const r=h.value[t];return D(r)?r(l,(i=n.value)==null?void 0:i.getNode(a("value",l))):l[r]},g=N(e.modelValue).map(t=>E(e.data||[],l=>a("value",l)===t,l=>a("children",l),(l,i,r,y)=>y&&a("value",y))).filter(t=>T(t)),k=C(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return q(e.data.concat(e.cacheData),l=>{const i=a("value",l);t.push({value:i,currentLabel:a("label",l),isDisabled:a("disabled",l)})},l=>a("children",l)),t}),m=C(()=>k.value.reduce((t,l)=>({...t,[l.value]:l}),{}));return{...V(H(e),Object.keys(M.props)),...c,nodeKey:s,expandOnClickNode:C(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:C(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(g):g),renderContent:(t,{node:l,data:i,store:r})=>t(Q,{value:a("value",i),label:a("label",i),disabled:a("disabled",i)},e.renderContent?()=>e.renderContent(t,{node:l,data:i,store:r}):d.default?()=>d.default({node:l,data:i,store:r}):void 0),filterNodeMethod:(t,l,i)=>{var r;return e.filterNodeMethod?e.filterNodeMethod(t,l,i):t?(r=a("label",l))==null?void 0:r.includes(t):!0},onNodeClick:(t,l,i)=>{var r,y,K;if((r=c.onNodeClick)==null||r.call(c,t,l,i),!(e.showCheckbox&&e.checkOnClickNode))if(!e.showCheckbox&&(e.checkStrictly||l.isLeaf)){if(!a("disabled",t)){const f=(y=o.value)==null?void 0:y.options.get(a("value",t));(K=o.value)==null||K.handleOptionSelect(f)}}else e.expandOnClickNode&&i.proxy.handleExpandIconClick()},onCheck:(t,l)=>{if(!e.showCheckbox)return;const i=a("value",t),r=l.checkedKeys,y=e.multiple?N(e.modelValue).filter(f=>f in m.value&&!n.value.getNode(f)&&!r.includes(f)):[],K=r.concat(y);if(e.checkStrictly)u(x,e.multiple?K:K.includes(i)?i:void 0);else if(e.multiple)u(x,n.value.getCheckedKeys(!0));else{const f=E([t],v=>!j(a("children",v))&&!a("disabled",v),v=>a("children",v)),b=f?a("value",f):void 0,B=T(e.modelValue)&&!!E([t],v=>a("value",v)===e.modelValue,v=>a("children",v));u(x,b===e.modelValue||B?void 0:b)}O(()=>{var f;const b=N(e.modelValue);n.value.setCheckedKeys(b),(f=c.onCheck)==null||f.call(c,t,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})})},cacheOptions:k}};var Y=L({props:{data:{type:Array,default:()=>[]}},setup(e){const c=R(F);return I(()=>e.data,()=>{var d;e.data.forEach(o=>{c.cachedOptions.has(o.value)||c.cachedOptions.set(o.value,o)});const u=((d=c.selectWrapper)==null?void 0:d.querySelectorAll("input"))||[];Array.from(u).includes(document.activeElement)||c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const Z=L({name:"ElTreeSelect",inheritAttrs:!1,props:{...S.props,...M.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:d,expose:u}=c,o=P(),n=P(),s=C(()=>e.nodeKey||e.valueKey||"value"),h=J(e,c,{select:o,tree:n,key:s}),{cacheOptions:a,...g}=X(e,c,{select:o,tree:n,key:s}),k=p({});return u(k),U(()=>{Object.assign(k,{...V(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...V(o.value,["focus","blur"])})}),()=>A(S,p({...h,ref:m=>o.value=m}),{...d,default:()=>[A(Y,{data:a.value}),A(M,p({...g,ref:m=>n.value=m}))]})}});var _=W(Z,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tree-select/src/tree-select.vue"]]);_.install=e=>{e.component(_.name,_)};const ee=_,se=ee;export{se as E};
