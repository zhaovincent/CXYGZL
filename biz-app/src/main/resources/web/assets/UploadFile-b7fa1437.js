import{d as V,r as _,L as U,a as p,c as w,a5 as v,w as y,a3 as A,f as x,as as b,k as I,R as B,a7 as R,aD as S,h as z,l as h}from"./index-d5547550.js";/* empty css                  */import{E as F}from"./el-progress-562499f2.js";import{u as N,d as O}from"./index-15f47425.js";import{E as q}from"./index-a6355ec2.js";const C=["src"],D=V({__name:"MultiUploadFile",props:{disabled:{type:Boolean,default:!1},modelValue:{type:Array,default:[]},limit:{type:Number,default:10},maxSize:{type:Number,default:10}},emits:["update:modelValue"],setup(o,{emit:m}){const d=o,c=_(""),t=_(!1),a=_([]);U(()=>d.modelValue,e=>{const l=a.value.map(r=>r.url);l.length>0&&l.length===e.length&&l.every(r=>e.some(n=>n===r))&&e.every(r=>l.some(n=>n===r))||(a.value=e.map(r=>({url:r.url,name:r.name})))},{immediate:!0});async function i(e){console.log(e);const{data:l}=await N(e.file),r=a.value.findIndex(n=>n.uid==e.file.uid);a.value.splice(r,1,{name:e.file.name,url:l}),m("update:modelValue",a.value.map(n=>({url:n.url,name:n.name})))}function f(e){const l=e.url;l&&O(l).then(()=>{m("update:modelValue",a.value.map(r=>({url:r.url,name:r.name})))})}function u(e){return e.size>d.maxSize*1048*1048?(R.warning("上传文件不能大于"+d.maxSize+"M"),!1):!0}const s=e=>{c.value=e.url,t.value=!0};return(e,l)=>{const r=S,n=F,E=q;return p(),w(B,null,[v(n,{"file-list":x(a),"onUpdate:fileList":l[0]||(l[0]=g=>b(a)?a.value=g:null),"before-upload":u,"http-request":i,"on-remove":f,"on-preview":s,limit:d.limit,disabled:o.disabled},{default:y(()=>[v(r,{type:"primary"},{default:y(()=>[A("选择文件")]),_:1})]),_:1},8,["file-list","limit","disabled"]),v(E,{modelValue:x(t),"onUpdate:modelValue":l[1]||(l[1]=g=>b(t)?t.value=g:null)},{default:y(()=>[I("img",{"w-full":"",src:x(c),alt:"Preview Image"},null,8,C)]),_:1},8,["modelValue"])],64)}}}),M=V({__name:"UploadFile",props:{mode:{type:String,default:"D"},form:{type:Object,default:()=>{}}},setup(o,{expose:m}){const d=o;return z(),m({getValidateRule:()=>{var t=d.form,a=(f,u,s)=>{if(t.required&&(!u||u.length==0))return s(new Error("请上传"+t.name));if(!u||u.length==0)return s();if(t.props.min&&u.length<t.props.min)return s(new Error("上传数量不能小于"+t.props.min));if(t.props.suffixArray&&t.props.suffixArray.length>0)for(var e of u){let r=e.name;var l=r.substring(r.lastIndexOf(".")+1);if(t.props.suffixArray.indexOf(l)<0)return s(new Error("文件只支持"+t.props.suffixArray+"格式"))}return s()};let i=[{validator:a,trigger:"blur"}];return t.required&&i.push({required:!0,message:"请上传"+t.name,trigger:"blur"}),i}}),(t,a)=>{const i=D;return p(),w("div",null,[o.mode==="D"?(p(),h(i,{key:0,disabled:!0})):(p(),h(i,{key:1,modelValue:o.form.props.value,"onUpdate:modelValue":a[0]||(a[0]=f=>o.form.props.value=f),disabled:o.form.perm==="R"},null,8,["modelValue","disabled"]))])}}}),$=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"}));export{$ as _};
