import{d as de,D as f,r as I,L as E,h as ie,a as s,l as p,w as a,a5 as o,f as r,c,R as b,a6 as V,a3 as v,am as g,as as me,aD as pe}from"./index-d5547550.js";import{E as fe}from"./el-drawer-75c80c60.js";/* empty css                */import{E as ve}from"./el-input-number-f4eeab94.js";/* empty css                       */import{E as ce,a as be}from"./el-radio-92787871.js";import{a as Ve,E as _e}from"./el-row-a594fbeb.js";import{a as ge,E as ye}from"./el-form-item-2de9c3c8.js";import"./el-tag-de6752b8.js";import{E as Fe,a as Me}from"./el-select-46753b34.js";import"./el-scrollbar-cbe0c54f.js";import"./el-popper-00977718.js";import{a as we}from"./index-6d308f65.js";import{g as he}from"./index-3b3587d2.js";import{$ as Ce}from"./index-a7c7b111.js";import{u as ke}from"./index-71f0fd6b.js";import{u as Ue}from"./flow-165b4256.js";const je=de({__name:"subProcessDrawer",setup(Le){const q=f(()=>{var t=e.value;return!!(t.multiple&&t.multipleMode==3&&w.$isNotBlank(t.multipleModeValue))});let e=I({});const T=t=>{e.value.starterMode=1,e.value.multipleSubFormId=""},G=t=>{e.value.starterMode=1},J=f(()=>{let t=e.value;if(!(t.multiple&&t.multipleMode==3))return!1;let l=t.multipleModeValue;if(l==null)return!1;let d=B.value.filter(n=>n.id===l);return d.length==0?!1:d[0].type==="SelectMultiUser"}),K=()=>{e.value.multipleModeValue="",e.value.starterMode=1},D=t=>{e.value[t].push({field:"",value:""})},P=(t,l)=>{e.value[t].splice(l,1)};let S=ke(),{setSubProcessConfig:j,setSubProcess:A}=S,H=f(()=>S.subProcessDrawer),$=f(()=>S.subProcessConfigData),C=f({get(){return H.value},set(){z()}});E($,t=>{e.value=t.value});const{proxy:w}=ie(),F=I([]),Q=t=>{e.value.pcFormList[t].value=""},W=t=>{e.value.cpFormList[t].value=""},X=t=>{if(w.$isBlank(t))return[];let l=M.value.filter(i=>i.id===t);if(l.length==0)return[];let d=l[0].type;return F.value.filter(i=>i.type===d)},Y=t=>{if(w.$isBlank(t))return[];let l=F.value.filter(i=>i.id===t);if(l.length==0)return[];let d=l[0].type;return M.value.filter(i=>i.type===d)},Z=t=>{N(t,!0)},N=(t,l)=>{he(t).then(d=>{const{data:i}=d;let n=i.formItems;F.value=JSON.parse(n).filter(y=>y.type!=="Description"),l&&(e.value.pcFormList.splice(0,e.value.pcFormList.length),e.value.multipleSubFormId="")})};let x=Ue();var ee=f(()=>M.value.filter(t=>t.type==="SelectUser")),le=f(()=>M.value.filter(t=>t.type==="Number")),B=f(()=>M.value.filter(t=>t.type==="SelectMultiUser"||t.type==="SelectMultiDept"||t.type==="UploadImage"||t.type==="UploadFile"));const te=f(()=>{var t=e.value;let l=t.multipleModeValue,d=M.value.filter(n=>n.id===l);if(d.length==0)return[];let i=d[0].type;return i==="SelectMultiUser"?F.value.filter(n=>n.type==="SelectUser"):i==="SelectMultiDept"?F.value.filter(n=>n.type==="SelectDept"):F.value.filter(n=>n.type===i)});var M=f(()=>x.step2.filter(t=>t.type!=="Description")),k=I([]);const ae=()=>{we(!1).then(t=>{const{data:l}=t;for(var d of l)k.value=k.value.concat(d.items)}),w.$isNotBlank(e.value.subFlowId)&&N(e.value.subFlowId,!1)},ue=f(()=>e.value.subFlowId);E(()=>ue.value,t=>{let l=k.value.filter(d=>d.flowId===t);l.length==0?e.value.subFlowName=w.$isNotBlank(e.value.subFlowName)?e.value.subFlowName:"":e.value.subFlowName=l[0].name});const oe=f(()=>x.step2);E(()=>oe.value,t=>{let l=e.value;if(l.starterMode==2&&t.filter(n=>n.id===l.starterValue).length==0&&(l.starterValue=""),l.multiple&&(l.multipleMode==2||l.multipleMode==3)&&t.filter(n=>n.id===l.multipleModeValue).length==0&&(l.multipleModeValue="",l.starterMode=1),l.pcFormList)for(var d of l.pcFormList)t.filter(n=>n.id===d.field).length==0&&(d.field="",d.value="")});const re=()=>{e.value.error=!Ce.subProcessOK(e.value),j({value:e.value,flag:!0,id:$.value.id}),z()},z=()=>{A(!1)};return(t,l)=>{const d=Fe,i=Me,n=ge,y=Ve,U=pe,R=_e,_=ce,L=be,O=ve,ne=ye,se=fe;return s(),p(se,{"append-to-body":!0,title:"子流程设置",modelValue:r(C),"onUpdate:modelValue":l[13]||(l[13]=u=>me(C)?C.value=u:C=u),onOpen:ae,class:"set_copyer","show-close":!1,size:550,"before-close":re},{default:a(()=>[o(ne,{"label-width":"120px","label-position":"top"},{default:a(()=>[o(n,{label:"🌺选择子流程"},{default:a(()=>[o(i,{onChange:Z,modelValue:r(e).subFlowId,"onUpdate:modelValue":l[0]||(l[0]=u=>r(e).subFlowId=u),placeholder:"请选择子流程"},{default:a(()=>[(s(!0),c(b,null,V(r(k),u=>(s(),p(d,{label:u.name,value:u.flowId},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"👉主→子变量传递"},{default:a(()=>[(s(!0),c(b,null,V(r(e).pcFormList,(u,h)=>(s(),p(R,{style:{width:"100%","margin-bottom":"20px"},gutter:20},{default:a(()=>[o(y,{span:12},{default:a(()=>[o(n,null,{default:a(()=>[o(n,null,{default:a(()=>[o(i,{modelValue:u.field,"onUpdate:modelValue":m=>u.field=m,onChange:m=>Q(h),placeholder:"选择主流程表单",style:{width:"100%"}},{default:a(()=>[(s(!0),c(b,null,V(r(M),m=>(s(),p(d,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(y,{span:11},{default:a(()=>[o(n,null,{default:a(()=>[o(i,{modelValue:u.value,"onUpdate:modelValue":m=>u.value=m,placeholder:"选择子流程表单",style:{width:"100%"}},{default:a(()=>[(s(!0),c(b,null,V(X(u.field),m=>(s(),p(d,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(y,{span:1},{default:a(()=>[o(U,{onClick:m=>P("pcFormList",h),text:"",icon:t.$icon.Delete},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1024))),256)),o(U,{text:"",type:"primary",onClick:l[1]||(l[1]=u=>D("pcFormList")),icon:t.$icon.Plus},{default:a(()=>[v("添加一行 ")]),_:1},8,["icon"])]),_:1}),o(n,{label:"🫵是否多实例"},{default:a(()=>[o(L,{modelValue:r(e).multiple,"onUpdate:modelValue":l[2]||(l[2]=u=>r(e).multiple=u),class:"ml-4",onChange:G},{default:a(()=>[o(_,{label:!0,size:"large"},{default:a(()=>[v("是")]),_:1}),o(_,{label:!1,size:"large"},{default:a(()=>[v("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(e).multiple?(s(),p(n,{key:0,label:"🤝是否并行"},{default:a(()=>[o(L,{modelValue:r(e).sequential,"onUpdate:modelValue":l[3]||(l[3]=u=>r(e).sequential=u),class:"ml-4"},{default:a(()=>[o(_,{label:!1,size:"large"},{default:a(()=>[v("是")]),_:1}),o(_,{label:!0,size:"large"},{default:a(()=>[v("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})):g("",!0),r(e).multiple?(s(),p(n,{key:1,label:"🤲完成比例(%)"},{default:a(()=>[o(O,{modelValue:r(e).completeRate,"onUpdate:modelValue":l[4]||(l[4]=u=>r(e).completeRate=u),precision:2,"value-on-clear":"max","controls-position":"right",min:.01,step:.01,max:100},null,8,["modelValue"])]),_:1})):g("",!0),r(e).multiple?(s(),p(n,{key:2,label:"👏多实例来源"},{default:a(()=>[o(L,{modelValue:r(e).multipleMode,"onUpdate:modelValue":l[5]||(l[5]=u=>r(e).multipleMode=u),class:"ml-4",onChange:K},{default:a(()=>[o(_,{label:1,size:"large"},{default:a(()=>[v("固定数量")]),_:1}),o(_,{label:2,size:"large"},{default:a(()=>[v("数字表单")]),_:1}),o(_,{label:3,size:"large"},{default:a(()=>[v("多项表单")]),_:1})]),_:1},8,["modelValue"])]),_:1})):g("",!0),r(e).multiple&&r(e).multipleMode==1?(s(),p(n,{key:3,label:"✍固定数量"},{default:a(()=>[o(O,{modelValue:r(e).multipleModeValue,"onUpdate:modelValue":l[6]||(l[6]=u=>r(e).multipleModeValue=u),"value-on-clear":"min","controls-position":"right",min:1,step:1,max:100},null,8,["modelValue"])]),_:1})):g("",!0),r(e).multiple&&r(e).multipleMode==2?(s(),p(n,{key:4,label:"✍数字表单"},{default:a(()=>[o(i,{modelValue:r(e).multipleModeValue,"onUpdate:modelValue":l[7]||(l[7]=u=>r(e).multipleModeValue=u),placeholder:"请选择表单"},{default:a(()=>[(s(!0),c(b,null,V(r(le),u=>(s(),p(d,{label:u.name,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):g("",!0),r(e).multiple&&r(e).multipleMode==3?(s(),p(n,{key:5,label:"✍多项表单"},{default:a(()=>[o(i,{modelValue:r(e).multipleModeValue,"onUpdate:modelValue":l[8]||(l[8]=u=>r(e).multipleModeValue=u),placeholder:"请选择表单",onChange:T},{default:a(()=>[(s(!0),c(b,null,V(r(B),u=>(s(),p(d,{label:u.name,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):g("",!0),q.value?(s(),p(n,{key:6,label:"多项表单单向变量传递"},{default:a(()=>[o(i,{modelValue:r(e).multipleSubFormId,"onUpdate:modelValue":l[9]||(l[9]=u=>r(e).multipleSubFormId=u),placeholder:"请选择表单"},{default:a(()=>[(s(!0),c(b,null,V(te.value,u=>(s(),p(d,{label:u.name,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):g("",!0),o(n,{label:"👨‍💻子流程发起人"},{default:a(()=>[o(L,{modelValue:r(e).starterMode,"onUpdate:modelValue":l[10]||(l[10]=u=>r(e).starterMode=u)},{default:a(()=>[o(_,{label:1},{default:a(()=>[v("同主流程发起人")]),_:1}),o(_,{label:2},{default:a(()=>[v("表单")]),_:1}),J.value?(s(),p(_,{key:0,label:3},{default:a(()=>[v("多实例内部用户")]),_:1})):g("",!0)]),_:1},8,["modelValue"])]),_:1}),r(e).starterMode==2?(s(),p(n,{key:7,label:"发起人表单"},{default:a(()=>[o(i,{modelValue:r(e).starterValue,"onUpdate:modelValue":l[11]||(l[11]=u=>r(e).starterValue=u),placeholder:"请选择发起人"},{default:a(()=>[(s(!0),c(b,null,V(r(ee),u=>(s(),p(d,{label:u.name,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):g("",!0),r(e).multiple?g("",!0):(s(),p(n,{key:8,label:"👆子→主变量传递"},{default:a(()=>[(s(!0),c(b,null,V(r(e).cpFormList,(u,h)=>(s(),p(R,{style:{width:"100%","margin-bottom":"20px"},gutter:20},{default:a(()=>[o(y,{span:12},{default:a(()=>[o(n,null,{default:a(()=>[o(n,null,{default:a(()=>[o(i,{modelValue:u.field,"onUpdate:modelValue":m=>u.field=m,onChange:m=>W(h),placeholder:"选择子流程表单",style:{width:"100%"}},{default:a(()=>[(s(!0),c(b,null,V(F.value,m=>(s(),p(d,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(y,{span:11},{default:a(()=>[o(n,null,{default:a(()=>[o(i,{modelValue:u.value,"onUpdate:modelValue":m=>u.value=m,placeholder:"选择主流程表单",style:{width:"100%"}},{default:a(()=>[(s(!0),c(b,null,V(Y(u.field),m=>(s(),p(d,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(y,{span:1},{default:a(()=>[o(U,{onClick:m=>P("cpFormList",h),text:"",icon:t.$icon.Delete},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1024))),256)),o(U,{text:"",type:"primary",onClick:l[12]||(l[12]=u=>D("cpFormList")),icon:t.$icon.Plus},{default:a(()=>[v("添加一行 ")]),_:1},8,["icon"])]),_:1}))]),_:1})]),_:1},8,["modelValue"])}}});export{je as _};
