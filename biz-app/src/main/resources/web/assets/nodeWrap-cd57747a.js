import{h as z,D as y,L as m,r as M,o as ao,a2 as fo,ca as go,a as s,c as r,k as d,au as uo,f as h,q as v,R as k,P as J,cA as F,am as a,n as A,a5 as U,a6 as q,l as W,ag as Co,ah as ho}from"./index-e01dade3.js";import S from"./addNode-6db4a717.js";import{p as vo,b as No}from"./const-36faa2f4.js";import{$ as _}from"./index-126d0406.js";/* empty css                                                                 */import{_ as po}from"./_plugin-vue_export-helper-c27b6911.js";import{u as yo}from"./index-219f5c7e.js";import{u as ko}from"./flow-2349aa77.js";import"./el-popper-ee5283d6.js";import"./el-popover-70136418.js";import"./dropdown-b5481c97.js";const g=i=>(Co("data-v-54a8d49f"),i=i(),ho(),i),_o={key:0,class:"node-wrap"},mo={key:0},bo={class:"iconfont"},Lo=["placeholder"],Uo={class:"text"},So=g(()=>d("i",{class:"anticon anticon-right arrow"},null,-1)),$o={key:0,class:"error_tip"},Po=g(()=>d("i",{class:"anticon anticon-exclamation-circle"},null,-1)),wo=[Po],Io={key:1,class:"branch-wrap"},To={class:"branch-box-wrap"},Bo={class:"branch-box"},Do={class:"condition-node"},Oo={class:"condition-node-box"},Vo=["onClick"],Jo={class:"title-wrapper"},Fo=["onBlur","onUpdate:modelValue"],Ao=["onClick"],Wo=["onClick"],Eo=["onClick"],Ho=["onClick"],jo=["onClick"],Ro={key:3,class:"content"},zo={key:4,class:"error_tip"},Mo=g(()=>d("i",{class:"anticon anticon-exclamation-circle"},null,-1)),qo=[Mo],Go=g(()=>d("div",{class:"top-left-cover-line"},null,-1)),Ko=g(()=>d("div",{class:"bottom-left-cover-line"},null,-1)),Qo=g(()=>d("div",{class:"top-right-cover-line"},null,-1)),Xo=g(()=>d("div",{class:"bottom-right-cover-line"},null,-1)),Yo={key:2,class:"branch-wrap"},Zo={class:"branch-box-wrap"},xo={class:"branch-box"},oe={class:"condition-node"},ee={class:"condition-node-box"},ne=["onClick"],te={class:"title-wrapper"},ie=["onBlur","onUpdate:modelValue"],de=["onClick"],le=["onClick"],se=["onClick"],ce={class:"content"},re={key:2,class:"error_tip"},ae=g(()=>d("i",{class:"anticon anticon-exclamation-circle"},null,-1)),fe=[ae],ge=g(()=>d("div",{class:"top-left-cover-line"},null,-1)),ue=g(()=>d("div",{class:"bottom-left-cover-line"},null,-1)),Ce=g(()=>d("div",{class:"top-right-cover-line"},null,-1)),he=g(()=>d("div",{class:"bottom-right-cover-line"},null,-1)),ve={__name:"nodeWrap",props:{nodeConfig:{type:Object,default:()=>({})}},emits:["update:nodeConfig"],setup(i,{emit:C}){const o=i;let p=z().uid,I=y(()=>vo[o.nodeConfig.type]);var T=y(()=>o.nodeConfig.type==0?_.arrToStr(o.nodeConfig.nodeUserList)||"所有人":o.nodeConfig.type==1?_.setApproverStr(o.nodeConfig):o.nodeConfig.type==2?_.copyerStr(o.nodeConfig):"");m(T,(e,n,f)=>{o.nodeConfig.placeHolder=e});let G=ko();const K=y(()=>G.step2);m(()=>K.value,e=>{let n=o.nodeConfig;if(n.type==1&&n.assignedType==8){let c=n.formUserId;e.filter(ro=>ro.id===c).length==0&&(n.formUserId="",n.formUserName="",n.error=!0)}if(n.type==4){var f=0,u=n.conditionNodes.length;for(var N of n.conditionNodes){if(f>=u-1)break;for(var t of N.conditionList)for(var l of t.conditionList)e.filter(R=>R.id===l.key).length==0&&(l.key="",l.expression="",l.keyType="",l.value="",N.error=!0);f++}}});let $=M([]),B=M(!1);const P=()=>{if(o.nodeConfig.type!=5)for(var e=0;e<o.nodeConfig.conditionNodes.length;e++){let N=o.nodeConfig.conditionNodes[e];N.error=!1;let t=N.conditionList;if(e!=o.nodeConfig.conditionNodes.length-1){var n=t.length==0;for(var f of t){n=f.conditionList.length==0;for(var u of f.conditionList)if(L.$isBlank(u.key)||L.$isBlank(u.expression)||L.$isBlank(u.value)){n=!0;break}}N.error=n}}};ao(()=>{o.nodeConfig.type==1?o.nodeConfig.error=!_.checkApproval(o.nodeConfig):o.nodeConfig.type==2?o.nodeConfig.error=!_.copyerStr(o.nodeConfig):o.nodeConfig.type==4&&P()});let b=yo(),{setPromoter:Q,setApprover:X,setCopyer:Y,setCondition:Z,setStarterConfig:x,setApproverConfig:oo,setCopyerConfig:eo,setConditionsConfig:no}=b,to=y(()=>b.starterConfigData),io=y(()=>b.approverConfigData),lo=y(()=>b.copyerConfig1),so=y(()=>b.conditionsConfig1);m(to,e=>{e.flag&&e.id===p&&C("update:nodeConfig",e.value)}),m(io,e=>{e.flag&&e.id===p&&C("update:nodeConfig",e.value)}),m(lo,e=>{e.flag&&e.id===p&&C("update:nodeConfig",e.value)}),m(so,e=>{e.flag&&e.id===p&&C("update:nodeConfig",e.value)});const D=e=>{e||e===0?$.value[e]=!0:B.value=!0},O=e=>{e||e===0?($.value[e]=!1,o.nodeConfig.conditionNodes[e].nodeName=o.nodeConfig.conditionNodes[e].nodeName||"条件"):(B.value=!1,o.nodeConfig.nodeName=o.nodeConfig.nodeName||I)},{proxy:L}=z(),co=()=>{C("update:nodeConfig",o.nodeConfig.childNode)},E=()=>{if(o.nodeConfig.type==5){let n=o.nodeConfig.conditionNodes.length+1;o.nodeConfig.conditionNodes.push({nodeName:"分支"+n,type:3,id:L.$getRandomId(),placeHolder:"满足条件",parentId:o.nodeConfig.id,priorityLevel:n,conditionList:[{conditionList:[]}],nodeUserList:[],childNode:null}),C("update:nodeConfig",o.nodeConfig);return}let e=o.nodeConfig.conditionNodes.length+1;o.nodeConfig.conditionNodes.push({nodeName:"条件"+e,type:3,parentId:o.nodeConfig.id,id:L.$getRandomId(),priorityLevel:e,conditionList:[{mode:!0,conditionList:[{key:"",expression:""}]}],nodeUserList:[],childNode:null}),P(),C("update:nodeConfig",o.nodeConfig)},H=e=>{o.nodeConfig.conditionNodes.splice(e,1),o.nodeConfig.conditionNodes.map((n,f)=>{n.priorityLevel=f+1,n.nodeName=`条件${f+1}`}),P(),C("update:nodeConfig",o.nodeConfig),o.nodeConfig.conditionNodes.length==1&&(o.nodeConfig.childNode&&(o.nodeConfig.conditionNodes[0].childNode?j(o.nodeConfig.conditionNodes[0].childNode,o.nodeConfig.childNode):o.nodeConfig.conditionNodes[0].childNode=o.nodeConfig.childNode),C("update:nodeConfig",o.nodeConfig.conditionNodes[0].childNode))},j=(e,n)=>{e.childNode?j(e.childNode,n):e.childNode=n},V=e=>{var{type:n}=o.nodeConfig;n==0?(Q(!0),x({value:JSON.parse(JSON.stringify(o.nodeConfig)),flag:!1,id:p})):n==1?(X(!0),oo({value:{...JSON.parse(JSON.stringify(o.nodeConfig)),assignedType:o.nodeConfig.assignedType?o.nodeConfig.assignedType:1,multiple:!1},flag:!1,id:p})):n==2?(Y(!0),eo({value:JSON.parse(JSON.stringify(o.nodeConfig)),flag:!1,id:p})):(Z(!0),no({value:JSON.parse(JSON.stringify(o.nodeConfig)),priorityLevel:e,flag:!1,id:p}))},w=(e,n=1)=>{o.nodeConfig.conditionNodes[e]=o.nodeConfig.conditionNodes.splice(e+n,1,o.nodeConfig.conditionNodes[e])[0],o.nodeConfig.conditionNodes.map((f,u)=>{f.priorityLevel=u+1}),P(),C("update:nodeConfig",o.nodeConfig)};return(e,n)=>{var N;const f=fo("nodeWrap",!0),u=go("focus");return s(),r("div",null,[i.nodeConfig.type<3?(s(),r("div",_o,[d("div",{class:A(["node-wrap-box",(i.nodeConfig.type==0?"start-node ":"")+(i.nodeConfig.error?"active error":"")])},[d("div",{class:"title",style:uo(`background: rgb(${h(No)[i.nodeConfig.type]});`)},[i.nodeConfig.type==0?(s(),r("span",mo,v(i.nodeConfig.nodeName),1)):(s(),r(k,{key:1},[d("span",bo,v(i.nodeConfig.type==1?"":""),1),h(B)?J((s(),r("input",{key:0,type:"text",class:"ant-input editable-title-input",onBlur:n[0]||(n[0]=t=>O()),onFocus:n[1]||(n[1]=t=>t.currentTarget.select()),"onUpdate:modelValue":n[2]||(n[2]=t=>i.nodeConfig.nodeName=t),placeholder:h(I)},null,40,Lo)),[[u],[F,i.nodeConfig.nodeName]]):(s(),r("span",{key:1,class:"editable-title",onClick:n[3]||(n[3]=t=>D())},v(i.nodeConfig.nodeName),1)),d("i",{class:"anticon anticon-close close",onClick:co})],64))],4),d("div",{class:"content",onClick:V},[d("div",Uo,v(((N=h(T))==null?void 0:N.length)>0?h(T):"请选择"+h(I)),1),So]),i.nodeConfig.error?(s(),r("div",$o,wo)):a("",!0)],2),U(S,{"current-node":i.nodeConfig,childNodeP:i.nodeConfig.childNode,"onUpdate:childNodeP":n[4]||(n[4]=t=>i.nodeConfig.childNode=t)},null,8,["current-node","childNodeP"])])):a("",!0),i.nodeConfig.type==4?(s(),r("div",Io,[d("div",To,[d("div",Bo,[d("button",{class:"add-branch",onClick:E},"添加条件"),(s(!0),r(k,null,q(i.nodeConfig.conditionNodes,(t,l)=>(s(),r("div",{class:"col-box",key:l},[d("div",Do,[d("div",Oo,[d("div",{class:A(["auto-judge",t.error?"error active":""])},[l!=0?(s(),r("div",{key:0,class:"sort-left",onClick:c=>w(l,-1)},"<",8,Vo)):a("",!0),d("div",Jo,[h($)[l]?J((s(),r("input",{key:0,style:{width:"50%"},type:"text",class:"ant-input editable-title-input",onBlur:c=>O(l),onFocus:n[5]||(n[5]=c=>c.currentTarget.select()),"onUpdate:modelValue":c=>t.nodeName=c},null,40,Fo)),[[u],[F,t.nodeName]]):(s(),r("span",{key:1,class:"editable-title",onClick:c=>D(l)},v(t.nodeName),9,Ao)),d("span",{class:"priority-title",onClick:c=>V(t.priorityLevel)},"优先级"+v(t.priorityLevel),9,Wo),d("i",{class:"anticon anticon-close close",onClick:c=>H(l)},null,8,Eo)]),l!=i.nodeConfig.conditionNodes.length-1?(s(),r("div",{key:1,class:"sort-right",onClick:c=>w(l)},"> ",8,Ho)):a("",!0),l<i.nodeConfig.conditionNodes.length-1?(s(),r("div",{key:2,class:"content",onClick:c=>V(t.priorityLevel)},v(h(_).conditionStr(i.nodeConfig,l)),9,jo)):(s(),r("div",Ro,v(h(_).conditionStr(i.nodeConfig,l)),1)),t.error?(s(),r("div",zo,qo)):a("",!0)],2),U(S,{childNodeP:t.childNode,"onUpdate:childNodeP":c=>t.childNode=c,"current-node":t},null,8,["childNodeP","onUpdate:childNodeP","current-node"])])]),t.childNode?(s(),W(f,{key:0,nodeConfig:t.childNode,"onUpdate:nodeConfig":c=>t.childNode=c},null,8,["nodeConfig","onUpdate:nodeConfig"])):a("",!0),l==0?(s(),r(k,{key:1},[Go,Ko],64)):a("",!0),l==i.nodeConfig.conditionNodes.length-1?(s(),r(k,{key:2},[Qo,Xo],64)):a("",!0)]))),128))]),U(S,{childNodeP:i.nodeConfig.childNode,"onUpdate:childNodeP":n[6]||(n[6]=t=>i.nodeConfig.childNode=t),"current-node":i.nodeConfig},null,8,["childNodeP","current-node"])])])):a("",!0),i.nodeConfig.type==5?(s(),r("div",Yo,[d("div",Zo,[d("div",xo,[d("button",{class:"add-branch",onClick:E},"添加分支"),(s(!0),r(k,null,q(i.nodeConfig.conditionNodes,(t,l)=>(s(),r("div",{class:"col-box",key:l},[d("div",oe,[d("div",ee,[d("div",{class:A(["auto-judge",t.error?"error active":""])},[l!=0?(s(),r("div",{key:0,class:"sort-left",onClick:c=>w(l,-1)},"<",8,ne)):a("",!0),d("div",te,[h($)[l]?J((s(),r("input",{key:0,style:{width:"50%"},type:"text",class:"ant-input editable-title-input",onBlur:c=>O(l),onFocus:n[7]||(n[7]=c=>c.currentTarget.select()),"onUpdate:modelValue":c=>t.nodeName=c},null,40,ie)),[[u],[F,t.nodeName]]):(s(),r("span",{key:1,class:"editable-title",onClick:c=>D(l)},v(t.nodeName),9,de)),d("i",{class:"anticon anticon-close close",onClick:c=>H(l)},null,8,le)]),l!=i.nodeConfig.conditionNodes.length-1?(s(),r("div",{key:1,class:"sort-right",onClick:c=>w(l)},"> ",8,se)):a("",!0),d("div",ce,v(t.placeHolder),1),t.error?(s(),r("div",re,fe)):a("",!0)],2),U(S,{childNodeP:t.childNode,"onUpdate:childNodeP":c=>t.childNode=c,"current-node":t},null,8,["childNodeP","onUpdate:childNodeP","current-node"])])]),t.childNode?(s(),W(f,{key:0,nodeConfig:t.childNode,"onUpdate:nodeConfig":c=>t.childNode=c},null,8,["nodeConfig","onUpdate:nodeConfig"])):a("",!0),l==0?(s(),r(k,{key:1},[ge,ue],64)):a("",!0),l==i.nodeConfig.conditionNodes.length-1?(s(),r(k,{key:2},[Ce,he],64)):a("",!0)]))),128))]),U(S,{childNodeP:i.nodeConfig.childNode,"onUpdate:childNodeP":n[8]||(n[8]=t=>i.nodeConfig.childNode=t),"current-node":i.nodeConfig},null,8,["childNodeP","current-node"])])])):a("",!0),i.nodeConfig.childNode?(s(),W(f,{key:3,nodeConfig:i.nodeConfig.childNode,"onUpdate:nodeConfig":n[9]||(n[9]=t=>i.nodeConfig.childNode=t)},null,8,["nodeConfig"])):a("",!0)])}}},Pe=po(ve,[["__scopeId","data-v-54a8d49f"]]);export{Pe as default};
