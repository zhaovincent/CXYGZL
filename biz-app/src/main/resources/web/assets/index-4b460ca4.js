import{a as i,c as k,k as g,d as Pe,r as c,K as T,U as Ae,h as He,D as Oe,o as Ye,ck as Ke,a5 as l,w as a,f as t,as as Y,aA as je,a3 as d,P as F,l as u,q as ue,am as y,R as M,a6 as P,an as K,eE as Ge,a7 as f,eF as Je,eG as Xe,eH as Ze,eI as Qe,eJ as We,eK as el,aC as ll,aD as tl,E as ol,eL as al,eM as nl}from"./index-d5547550.js";import{v as rl}from"./el-loading-7d43f325.js";import{E as sl}from"./el-progress-562499f2.js";/* empty css                *//* empty css                  */import{E as il}from"./el-input-number-f4eeab94.js";import{E as ul}from"./el-time-picker-f79f3178.js";import"./el-scrollbar-cbe0c54f.js";import"./el-popper-00977718.js";import{E as dl}from"./el-date-picker-2b967550.js";/* empty css                       */import{E as pl,a as ml}from"./el-radio-92787871.js";import"./el-tag-de6752b8.js";import{E as cl,a as _l}from"./el-select-46753b34.js";import{E as de}from"./el-tree-75cc66b1.js";/* empty css                    */import{E as fl}from"./el-tree-select-35aec998.js";import{a as gl,E as vl}from"./el-row-a594fbeb.js";import{_ as yl}from"./index-bc35b8c7.js";import{E as hl,a as Vl}from"./el-table-column-ec0cff67.js";import"./el-tooltip-4ed993c7.js";import{_ as bl,a as kl,b as wl}from"./search-f5308daa.js";import{_ as Ul}from"./edit-ce3642cb.js";import{E as xl}from"./el-switch-a81630c6.js";/* empty css                  */import{_ as El}from"./plus-bafa12a0.js";/* empty css                */import{E as j,a as Cl}from"./el-form-item-2de9c3c8.js";import{E as Dl}from"./el-card-39a9c0d0.js";import{S as Il}from"./SingleUpload-ae616f10.js";import{l as Sl}from"./selectBox.vue_vue_type_style_index_0_scoped_82c14c6c_lang-f1c14f73.js";import{l as Tl}from"./index-afb454e8.js";import"./getFormWidget-6a62e076.js";import{E as Fl}from"./index-85bc974f.js";import{E as Nl}from"./index-a6355ec2.js";import"./cloneDeep-cfc40afc.js";import"./_baseClone-e7eb389f.js";import"./_Uint8Array-c7447712.js";import"./isEqual-fe47b28a.js";import"./index-da53d962.js";import"./panel-time-pick-ae955f65.js";import"./debounce-e2bc871f.js";import"./_baseFlatten-c80c9ba3.js";import"./isArrayLikeObject-724a27ce.js";import"./_overRest-d3d6b67b.js";import"./arrays-e667dc24.js";import"./flatten-36990bb8.js";import"./index-e8e7f773.js";import"./strings-fbdcd853.js";import"./index-01b2a18b.js";import"./index-222e6800.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./index-15f47425.js";import"./index-a7c7b111.js";import"./flow-165b4256.js";import"./const-a11e1fef.js";import"./Area-836e6083.js";import"./area-23a735cb.js";import"./Date-3e356dbd.js";import"./DateTime-de06f21f.js";import"./Description-41c11d92.js";import"./Empty-e21e601f.js";import"./Input-45ba5ba8.js";import"./Money-ca211554.js";import"./el-text-a7cd3acd.js";import"./MultiSelect-355b84fc.js";import"./Number-040385fc.js";import"./Score-a0ed8d55.js";import"./el-rate-1b1664df.js";import"./SelectDept-15a8e478.js";import"./selectAndShow.vue_vue_type_script_setup_true_lang-9eafc7ba.js";import"./employeesDialog-54936475.js";import"./selectBox-26a3a753.js";import"./selectResult-4abbf083.js";/* empty css                                                                     *//* empty css                                                                        */import"./use-dialog-27a1e524.js";import"./refs-5fd04da2.js";import"./orgItem-a67c9471.js";import"./SelectMultiDept-7fbc4ddc.js";import"./SelectMultiUser-a6f17dc4.js";import"./SelectUser-e4906c1f.js";import"./SingleSelect-915a5a36.js";import"./Textarea-466c5ec6.js";import"./Time-1bed9846.js";import"./UploadFile-b7fa1437.js";import"./UploadImage-478fe7ac.js";import"./MultiUpload-acf0a282.js";const $l={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ql=g("path",{fill:"currentColor",d:"M544 864V672h128L512 480L352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0 1 64 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 0 1 512 192a239.872 239.872 0 0 1 235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 0 1-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z"},null,-1),Bl=[ql];function zl(G,N){return i(),k("svg",$l,Bl)}const Rl={name:"ep-upload-filled",render:zl},Ll={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Ml=g("path",{fill:"currentColor",d:"M289.088 296.704h92.992a32 32 0 0 1 0 64H232.96a32 32 0 0 1-32-32V179.712a32 32 0 0 1 64 0v50.56a384 384 0 0 1 643.84 282.88a384 384 0 0 1-383.936 384a384 384 0 0 1-384-384h64a320 320 0 1 0 640 0a320 320 0 0 0-555.712-216.448z"},null,-1),Pl=[Ml];function Al(G,N){return i(),k("svg",Ll,Pl)}const Hl={name:"ep-refresh-left",render:Al},Ol={class:"app-container"},Yl={class:"search"},Kl={class:"flex justify-between"},jl={class:"dialog-footer"},Gl=g("div",{class:"el-upload__text"},[d(" 将文件拖到此处，或 "),g("em",null,"点击上传")],-1),Jl=g("div",{class:"el-upload__tip"},"xls/xlsx files",-1),Xl={class:"dialog-footer"},Fo=Pe({name:"User",inheritAttrs:!1,__name:"index",setup(G){const N=c(de),J=c(j),$=c(j),w=c(!1),X=c([]),E=c(0),V=T({visible:!1}),p=T({pageNum:1,pageSize:10}),Z=c(),n=T({status:1}),Q=T({name:[{required:!0,message:"姓名不能为空",trigger:"blur"}],avatarUrl:[{required:!0,message:"请上传头像",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}],gender:[{required:!0,message:"性别不能为空",trigger:"blur"}],email:[{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"手机号不能为空",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),q=c(),B=c(),W=c(),z=T({title:"用户导入",visible:!1}),C=c(0),D=c(),A=c([]);Ae(()=>{N.value.filter(q.value)},{flush:"post"});function pe(r,o){return r?o.label.indexOf(r)!==-1:!0}function me(r){p.deptId=r.id,U()}async function ce(){Tl().then(r=>{W.value=r.data})}function _e(r){const o=r.status===1?"启用":"停用";K.confirm("确认要"+o+r.phone+"用户吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>Ge(r.id,r.status)).then(()=>{f.success(o+"成功")}).catch(()=>{r.status=r.status===1?0:1})}function U(){w.value=!0,Je(p).then(({data:r})=>{Z.value=r.records,E.value=r.total}).finally(()=>{w.value=!1})}function I(){J.value.resetFields(),p.pageNum=1,p.deptId=void 0,U()}function fe(r){X.value=r.map(o=>o.id)}function ge(r){K.prompt("请输入用户「"+r.phone+"」的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:o})=>{if(!o)return f.warning("请输入新密码"),!1;Xe(r.id,o).then(()=>{f.success("密码重置成功，新密码是："+o)})}).catch(()=>{})}async function ee(r){await le(),await ce(),V.visible=!0,r?(V.title="修改用户",Ze(r).then(({data:o})=>{o.deptId=""+o.deptId,console.log(o);for(var h of o.userFieldDataList)Q[h.key]=[{required:h.required,message:h.name+"不能为空",trigger:"blur"}],n[h.key]=h.data;Object.assign(n,o)})):V.title="新增用户"}function R(){V.visible=!1,ve()}function ve(){$.value.resetFields(),$.value.clearValidate(),n.id=void 0,n.status=1}const{proxy:ye}=He(),he=Qe(()=>{$.value.validate(r=>{if(r){const o=n.id;n.fieldData=ye.$deepCopy(n),w.value=!0,o?al(o,n).then(()=>{f.success("修改用户成功"),R(),I()}).finally(()=>w.value=!1):nl(n).then(()=>{f.success("新增用户成功"),R(),I()}).finally(()=>w.value=!1)}})},3e3);function Ve(r){const o=[r||X.value].join(",");if(!o){f.warning("请勾选删除项");return}K.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){We(o).then(()=>{f.success("删除成功"),I()})})}async function le(){Sl().then(r=>{B.value=r.data})}const be=Oe(()=>function(r){return r==1?"男":r==2?"女":""});function ke(r){if(!/\.(xlsx|xls|XLSX|XLS)$/.test(r.name))return f.warning("上传Excel只能为xlsx、xls格式"),D.value=void 0,A.value=[],!1;D.value=r.raw}function we(){if(C.value){if(!D.value)return f.warning("上传Excel文件不能为空"),!1;el(C.value,D.value).then(r=>{f.success(r.data),H(),I()})}}function H(){z.visible=!1,D.value=void 0,A.value=[]}return Ye(()=>{le(),U()}),(r,o)=>{const h=bl,x=ll,Ue=de,te=Dl,oe=gl,m=Cl,b=cl,S=_l,_=tl,xe=kl,O=j,Ee=El,v=hl,ae=Fl,Ce=xl,De=Hl,Ie=Ul,Se=wl,Te=Vl,Fe=yl,Ne=vl,ne=fl,re=pl,$e=ml,se=dl,qe=ul,Be=il,ie=Nl,ze=Rl,Re=ol,Le=sl,L=Ke("hasPerm"),Me=rl;return i(),k("div",Ol,[l(Ne,{gutter:20},{default:a(()=>[l(oe,{lg:4,xs:24,class:"mb-[12px]"},{default:a(()=>[l(te,{shadow:"never"},{default:a(()=>[l(x,{modelValue:t(q),"onUpdate:modelValue":o[0]||(o[0]=e=>Y(q)?q.value=e:null),placeholder:"部门名称",clearable:""},{prefix:a(()=>[l(h)]),_:1},8,["modelValue"]),l(Ue,{ref_key:"deptTreeRef",ref:N,class:"mt-2",data:t(B),props:{children:"children",value:"id",label:"name",disabled:""},"expand-on-click-node":!1,"filter-node-method":pe,"default-expand-all":"",onNodeClick:me},null,8,["data"])]),_:1})]),_:1}),l(oe,{lg:20,xs:24},{default:a(()=>[g("div",Yl,[l(O,{ref_key:"queryFormRef",ref:J,model:t(p),inline:!0},{default:a(()=>[l(m,{label:"关键字",prop:"keywords"},{default:a(()=>[l(x,{modelValue:t(p).keywords,"onUpdate:modelValue":o[1]||(o[1]=e=>t(p).keywords=e),placeholder:"姓名/手机号",clearable:"",style:{width:"200px"},onKeyup:je(U,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:a(()=>[l(S,{modelValue:t(p).status,"onUpdate:modelValue":o[2]||(o[2]=e=>t(p).status=e),placeholder:"全部",clearable:"",style:{width:"200px"}},{default:a(()=>[l(b,{label:"启用",value:"1"}),l(b,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:a(()=>[l(_,{type:"primary",onClick:U},{default:a(()=>[l(h),d(" 搜索 ")]),_:1}),l(_,{onClick:I},{default:a(()=>[l(xe),d(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),l(te,{shadow:"never"},{header:a(()=>[g("div",Kl,[g("div",null,[F((i(),u(_,{type:"success",onClick:o[3]||(o[3]=e=>ee())},{default:a(()=>[l(Ee),d(" 新增 ")]),_:1})),[[L,["sys:user:add"]]])])])]),default:a(()=>[F((i(),u(Te,{data:t(Z),onSelectionChange:fe},{default:a(()=>[l(v,{type:"selection",width:"50",align:"center"}),l(v,{label:"头像",width:"180"},{default:a(e=>[e.row.avatarUrl&&e.row.avatarUrl.length>0?(i(),u(ae,{key:0,shape:"square",size:40,src:e.row.avatarUrl},null,8,["src"])):(i(),u(ae,{key:1,shape:"square",size:40},{default:a(()=>[d(ue(e.row.name.length>2?e.row.name.substring(0,2):e.row.name),1)]),_:2},1024))]),_:1}),l(v,{key:"phone",label:"手机号",align:"center",width:"180",prop:"phone"}),l(v,{label:"姓名",width:"120",align:"center",prop:"name"}),l(v,{label:"性别",width:"100",align:"center",prop:"gender"},{default:a(e=>[d(ue(be.value(e.row.gender)),1)]),_:1}),l(v,{label:"部门",width:"120",align:"center",prop:"deptName"}),l(v,{label:"状态",width:"180",align:"center",prop:"status"},{default:a(e=>[l(Ce,{modelValue:e.row.status,"onUpdate:modelValue":s=>e.row.status=s,"inactive-value":0,"active-value":1,onChange:s=>_e(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(v,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(v,{label:"操作",fixed:"right",width:"220"},{default:a(e=>[F((i(),u(_,{type:"primary",size:"small",link:"",onClick:s=>ge(e.row)},{default:a(()=>[l(De),d(" 重置密码 ")]),_:2},1032,["onClick"])),[[L,["sys:user:reset_pwd"]]]),F((i(),u(_,{type:"primary",link:"",size:"small",onClick:s=>ee(e.row.id)},{default:a(()=>[l(Ie),d(" 编辑 ")]),_:2},1032,["onClick"])),[[L,["sys:user:edit"]]]),F((i(),u(_,{type:"primary",link:"",size:"small",onClick:s=>Ve(e.row.id)},{default:a(()=>[l(Se),d(" 删除 ")]),_:2},1032,["onClick"])),[[L,["sys:user:delete"]]])]),_:1})]),_:1},8,["data"])),[[Me,t(w)]]),t(E)>0?(i(),u(Fe,{key:0,total:t(E),"onUpdate:total":o[4]||(o[4]=e=>Y(E)?E.value=e:null),page:t(p).pageNum,"onUpdate:page":o[5]||(o[5]=e=>t(p).pageNum=e),limit:t(p).pageSize,"onUpdate:limit":o[6]||(o[6]=e=>t(p).pageSize=e),onPagination:U},null,8,["total","page","limit"])):y("",!0)]),_:1})]),_:1})]),_:1}),l(ie,{modelValue:t(V).visible,"onUpdate:modelValue":o[14]||(o[14]=e=>t(V).visible=e),title:t(V).title,width:"600px","append-to-body":"",onClose:R},{footer:a(()=>[g("div",jl,[l(_,{type:"primary",onClick:t(he)},{default:a(()=>[d("确 定")]),_:1},8,["onClick"]),l(_,{onClick:R},{default:a(()=>[d("取 消")]),_:1})])]),default:a(()=>[l(O,{ref_key:"userFormRef",ref:$,model:t(n),rules:t(Q),"label-width":"80px"},{default:a(()=>[l(m,{label:"头像",prop:"avatarUrl"},{default:a(()=>[l(Il,{modelValue:t(n).avatarUrl,"onUpdate:modelValue":o[7]||(o[7]=e=>t(n).avatarUrl=e)},null,8,["modelValue"])]),_:1}),l(m,{label:"手机号",prop:"phone"},{default:a(()=>[l(x,{modelValue:t(n).phone,"onUpdate:modelValue":o[8]||(o[8]=e=>t(n).phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(m,{label:"姓名",prop:"name"},{default:a(()=>[l(x,{modelValue:t(n).name,"onUpdate:modelValue":o[9]||(o[9]=e=>t(n).name=e),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(m,{label:"所属部门",prop:"deptId"},{default:a(()=>[l(ne,{modelValue:t(n).deptId,"onUpdate:modelValue":o[10]||(o[10]=e=>t(n).deptId=e),placeholder:"请选择所属部门",data:t(B),filterable:"",props:{label:"name",value:"id"},"check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),l(m,{label:"性别",prop:"gender"},{default:a(()=>[l(S,{modelValue:t(n).gender,"onUpdate:modelValue":o[11]||(o[11]=e=>t(n).gender=e),placeholder:"请选择"},{default:a(()=>[l(b,{label:"男",value:1}),l(b,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"角色",prop:"roleIds"},{default:a(()=>[l(S,{modelValue:t(n).roleIds,"onUpdate:modelValue":o[12]||(o[12]=e=>t(n).roleIds=e),multiple:"",placeholder:"请选择"},{default:a(()=>[(i(!0),k(M,null,P(t(W),e=>(i(),u(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:a(()=>[l($e,{modelValue:t(n).status,"onUpdate:modelValue":o[13]||(o[13]=e=>t(n).status=e)},{default:a(()=>[l(re,{label:1},{default:a(()=>[d("正常")]),_:1}),l(re,{label:0},{default:a(()=>[d("禁用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),(i(!0),k(M,null,P(t(n).userFieldDataList,e=>(i(),u(m,{label:e.name,prop:e.key},{default:a(()=>[e.type=="SingleSelect"?(i(),u(S,{key:0,modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s},{default:a(()=>[(i(!0),k(M,null,P(JSON.parse(e.props).options,s=>(i(),u(b,{key:s.key,label:s.value,value:s.key},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):y("",!0),e.type=="MultiSelect"?(i(),u(S,{key:1,multiple:"",modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s,"collapse-tags":"","collapse-tags-tooltip":""},{default:a(()=>[(i(!0),k(M,null,P(JSON.parse(e.props).options,s=>(i(),u(b,{key:s.key,label:s.value,value:s.key},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):y("",!0),e.type=="Date"?(i(),u(se,{key:2,"value-format":"YYYY-MM-DD",modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s,type:"date"},null,8,["modelValue","onUpdate:modelValue"])):y("",!0),e.type=="Time"?(i(),u(qe,{key:3,"value-format":"HH:mm:ss",modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s,"arrow-control":""},null,8,["modelValue","onUpdate:modelValue"])):y("",!0),e.type=="DateTime"?(i(),u(se,{key:4,"value-format":"YYYY-MM-DD HH:mm:ss",modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s,type:"datetime"},null,8,["modelValue","onUpdate:modelValue"])):y("",!0),e.type=="Input"?(i(),u(x,{key:5,modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s},null,8,["modelValue","onUpdate:modelValue"])):y("",!0),e.type=="Textarea"?(i(),u(x,{key:6,type:"textarea",modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s},null,8,["modelValue","onUpdate:modelValue"])):y("",!0),e.type=="Number"?(i(),u(Be,{key:7,modelValue:t(n)[e.key],"onUpdate:modelValue":s=>t(n)[e.key]=s},null,8,["modelValue","onUpdate:modelValue"])):y("",!0)]),_:2},1032,["label","prop"]))),256))]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(ie,{modelValue:t(z).visible,"onUpdate:modelValue":o[16]||(o[16]=e=>t(z).visible=e),title:t(z).title,width:"600px","append-to-body":"",onClose:H},{footer:a(()=>[g("div",Xl,[l(_,{type:"primary",onClick:we},{default:a(()=>[d("确 定")]),_:1}),l(_,{onClick:H},{default:a(()=>[d("取 消")]),_:1})])]),default:a(()=>[l(O,{"label-width":"80px"},{default:a(()=>[l(m,{label:"部门"},{default:a(()=>[l(ne,{modelValue:t(C),"onUpdate:modelValue":o[15]||(o[15]=e=>Y(C)?C.value=e:null),placeholder:"请选择部门",data:t(B),filterable:"","check-strictly":""},null,8,["modelValue","data"])]),_:1}),l(m,{label:"Excel"},{default:a(()=>[l(Le,{class:"upload-demo",action:"",drag:"","auto-upload":!1,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","file-list":t(A),"on-change":ke,limit:1},{tip:a(()=>[Jl]),default:a(()=>[l(Re,{class:"el-icon--upload"},{default:a(()=>[l(ze)]),_:1}),Gl]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});export{Fo as default};
