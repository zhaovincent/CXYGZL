import{d as se,r as u,h as ie,D as de,K as k,o as pe,ca as me,a as d,c as ue,k as $,a5 as e,w as t,f as n,ay as _e,a3 as s,P as w,l as _,ae as I,am as ce,as as fe,a7 as E,an as ge,aA as ve,aB as ye}from"./index-e01dade3.js";import{v as be}from"./el-loading-b076b1a7.js";import{E as he}from"./el-dialog-1471a1af.js";import{E as ke,a as we}from"./el-radio-70657465.js";import{E as Ee}from"./el-input-number-182b17d2.js";import{E as Ve}from"./el-tag-929563f7.js";import{E as Ce,a as Ie}from"./el-select-c154265f.js";import"./el-scrollbar-f2029ad1.js";import"./el-popper-ee5283d6.js";import"./el-tree-5fcea156.js";import"./el-checkbox-123bf6dd.js";import{E as xe}from"./el-tree-select-af3ba868.js";import{E as De}from"./el-card-16bdf0d8.js";import{E as Ne,a as Ue}from"./el-table-column-7cf019e1.js";import"./el-tooltip-4ed993c7.js";import{_ as Be,a as Fe,b as qe}from"./search-93a6394a.js";import{_ as Re}from"./edit-26548300.js";import{_ as Te}from"./plus-95522b44.js";/* empty css                */import{E as x,a as Le}from"./el-form-item-85be6a3a.js";import{_ as Oe}from"./selectAndShow.vue_vue_type_script_setup_true_lang-a708354f.js";import{l as A,u as Se,b as $e,d as Ae}from"./index-8f0c79b2.js";import"./refs-dd65b3fd.js";import"./index-f7c59abe.js";import"./strings-6464b592.js";import"./isEqual-47390e81.js";import"./_Uint8Array-aeb50f83.js";import"./debounce-bf37b7f7.js";import"./index-6b517de5.js";import"./index-af3dbd4b.js";import"./flatten-178b99bc.js";import"./_baseFlatten-6e5398bc.js";import"./_overRest-a79e0547.js";import"./_baseClone-59dac119.js";import"./isArrayLikeObject-a5301880.js";import"./employeesDialog-3166dde1.js";import"./selectBox-a8819872.js";import"./el-avatar-63a3488d.js";/* empty css                */import"./index-126d0406.js";import"./flow-2349aa77.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./selectResult-ca10c7f8.js";import"./orgItem-da1d9713.js";const Ke={class:"app-container"},Me={class:"search"},Pe={class:"dialog-footer"},Tt=se({name:"Dept",inheritAttrs:!1,__name:"index",setup(je){u(!1);const{proxy:K}=ie(),V=de({get(){return K.$isNotBlank(l.leaderUserId)?[{id:l.leaderUserId,name:l.leaderName,avatar:l.leaderAvatar,type:"user"}]:[]},set(r){l.leaderName=r[0].name,l.leaderUserId=r[0].id,l.leaderAvatar=r[0].avatar}}),D=u(x),y=u(x),c=u(!1),N=u([]),p=k({visible:!1}),f=k({}),U=u(),B=u(),l=k({status:1,parentId:0,sort:1}),M=k({parentId:[{required:!0,message:"上级部门不能为空",trigger:"blur"}],name:[{required:!0,message:"部门名称不能为空",trigger:"blur"}],sort:[{required:!0,message:"显示排序不能为空",trigger:"blur"}],leaderName:[{required:!0,message:"请选择部门负责人",trigger:"blur"}]});function g(){c.value=!0,A(f).then(({data:r})=>{U.value=r,c.value=!1})}function F(){D.value.resetFields(),g()}function P(r){N.value=r.map(a=>a.id)}async function j(){A().then(r=>{B.value=r.data})}async function q(r,a,h){await j(),p.visible=!0,a?(p.title="修改部门",Object.assign(l,h)):(p.title="新增部门",l.parentId=r??0,Object.assign(l,{}))}function z(){y.value.validate(r=>{if(r){const a=l.id;c.value=!0,a?Se(a,l).then(()=>{E.success("修改成功"),b(),g()}).finally(()=>c.value=!1):$e(l).then(()=>{E.success("新增成功"),b(),g()}).finally(()=>c.value=!1)}})}function Q(r){const a=[r||N.value].join(",");if(!a){E.warning("请勾选删除项");return}ge.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Ae(a).then(()=>{E.success("删除成功"),F()})})}function b(){p.visible=!1,G()}function G(){y.value.resetFields(),y.value.clearValidate(),l.id=void 0,l.parentId=0,l.status=1,l.sort=1}return pe(()=>{g()}),(r,a)=>{const h=ve,i=Le,R=Ce,H=Ie,J=Be,m=ye,W=Fe,T=x,v=Ne,L=Ve,X=Te,Y=Re,Z=qe,ee=Ue,te=De,le=xe,ae=Ee,O=ke,oe=we,ne=he,C=me("hasPerm"),re=be;return d(),ue("div",Ke,[$("div",Me,[e(T,{ref_key:"queryFormRef",ref:D,model:n(f),inline:!0},{default:t(()=>[e(i,{label:"关键字",prop:"keywords"},{default:t(()=>[e(h,{modelValue:n(f).keywords,"onUpdate:modelValue":a[0]||(a[0]=o=>n(f).keywords=o),placeholder:"部门名称",onKeyup:_e(g,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(i,{label:"部门状态",prop:"status"},{default:t(()=>[e(H,{modelValue:n(f).status,"onUpdate:modelValue":a[1]||(a[1]=o=>n(f).status=o),placeholder:"部门状态",clearable:""},{default:t(()=>[e(R,{value:1,label:"正常"}),e(R,{value:0,label:"禁用"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(m,{class:"filter-item",type:"primary",onClick:g},{default:t(()=>[e(J),s(" 搜索 ")]),_:1}),e(m,{onClick:F},{default:t(()=>[e(W),s(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),e(te,null,{default:t(()=>[w((d(),_(ee,{data:U.value,"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"},onSelectionChange:P},{default:t(()=>[e(v,{type:"selection",width:"55",align:"center"}),e(v,{prop:"name",label:"部门名称","min-width":"200"}),e(v,{prop:"leaderName",label:"部门主管","min-width":"200"}),e(v,{prop:"status",label:"状态",width:"100"},{default:t(o=>[o.row.status==1?(d(),_(L,{key:0,type:"success"},{default:t(()=>[s("正常")]),_:1})):(d(),_(L,{key:1,type:"info"},{default:t(()=>[s("禁用")]),_:1}))]),_:1}),e(v,{prop:"sort",label:"排序",width:"100"}),e(v,{label:"操作",fixed:"right",align:"left",width:"200"},{default:t(o=>[w((d(),_(m,{type:"primary",link:"",size:"small",onClick:I(S=>q(o.row.id,void 0),["stop"])},{default:t(()=>[e(X),s(" 新增 ")]),_:2},1032,["onClick"])),[[C,["sys:dept:add"]]]),w((d(),_(m,{type:"primary",link:"",size:"small",onClick:I(S=>q(o.row.parentId,o.row.id,o.row),["stop"])},{default:t(()=>[e(Y),s(" 编辑 ")]),_:2},1032,["onClick"])),[[C,["sys:dept:edit"]]]),w((d(),_(m,{type:"primary",link:"",size:"small",onClick:I(S=>Q(o.row.id),["stop"])},{default:t(()=>[e(Z),s(" 删除 ")]),_:2},1032,["onClick"])),[[C,["sys:dept:delete"]]])]),_:1})]),_:1},8,["data"])),[[re,c.value]])]),_:1}),e(ne,{modelValue:n(p).visible,"onUpdate:modelValue":a[7]||(a[7]=o=>n(p).visible=o),title:n(p).title,width:"600px",onClosed:b},{footer:t(()=>[$("div",Pe,[e(m,{type:"primary",onClick:z},{default:t(()=>[s(" 确 定")]),_:1}),e(m,{onClick:b},{default:t(()=>[s(" 取 消")]),_:1})])]),default:t(()=>[e(T,{ref_key:"deptFormRef",ref:y,model:n(l),rules:n(M),"label-width":"120px"},{default:t(()=>[n(l).parentId===void 0||n(l).parentId>0?(d(),_(i,{key:0,label:"上级部门",prop:"parentId"},{default:t(()=>[e(le,{modelValue:n(l).parentId,"onUpdate:modelValue":a[2]||(a[2]=o=>n(l).parentId=o),placeholder:"选择上级部门",data:B.value,props:{label:"name",value:"id"},filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1})):ce("",!0),e(i,{label:"部门名称",prop:"name"},{default:t(()=>[e(h,{modelValue:n(l).name,"onUpdate:modelValue":a[3]||(a[3]=o=>n(l).name=o),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"部门负责人1",prop:"leaderName"},{default:t(()=>[e(Oe,{disabled:!1,orgList:n(V),"onUpdate:orgList":a[4]||(a[4]=o=>fe(V)?V.value=o:null),type:"user",multiple:!1},null,8,["orgList"])]),_:1}),e(i,{label:"显示排序",prop:"sort"},{default:t(()=>[e(ae,{modelValue:n(l).sort,"onUpdate:modelValue":a[5]||(a[5]=o=>n(l).sort=o),"controls-position":"right",style:{width:"100px"},min:0},null,8,["modelValue"])]),_:1}),e(i,{label:"部门状态"},{default:t(()=>[e(oe,{modelValue:n(l).status,"onUpdate:modelValue":a[6]||(a[6]=o=>n(l).status=o)},{default:t(()=>[e(O,{label:1},{default:t(()=>[s("正常")]),_:1}),e(O,{label:0},{default:t(()=>[s("禁用")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Tt as default};
