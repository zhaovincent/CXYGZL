import{d as se,r as u,h as ie,D as pe,K as k,o as de,ck as me,a as p,c as ue,k as $,a5 as e,w as t,f as r,aA as _e,a3 as s,P as w,l as _,ae as I,am as ce,as as fe,a7 as E,an as ge,aC as ve,aD as ye}from"./index-d5547550.js";import{v as be}from"./el-loading-7d43f325.js";/* empty css                  *//* empty css                       */import{E as he,a as ke}from"./el-radio-92787871.js";import{E as we}from"./el-input-number-f4eeab94.js";import{E as Ee}from"./el-tag-de6752b8.js";import{E as Ve,a as Ce}from"./el-select-46753b34.js";import"./el-scrollbar-cbe0c54f.js";import"./el-popper-00977718.js";import"./el-tree-75cc66b1.js";/* empty css                    */import{E as Ie}from"./el-tree-select-35aec998.js";import{E as De}from"./el-card-39a9c0d0.js";import{E as xe,a as Ne}from"./el-table-column-ec0cff67.js";import"./el-tooltip-4ed993c7.js";import{_ as Ue,a as Be,b as Fe}from"./search-f5308daa.js";import{_ as qe}from"./edit-ce3642cb.js";import{_ as Re}from"./plus-bafa12a0.js";/* empty css                */import{E as D,a as Te}from"./el-form-item-2de9c3c8.js";import{_ as Le}from"./selectAndShow.vue_vue_type_script_setup_true_lang-9eafc7ba.js";import{l as A,u as Oe,c as Se,e as $e}from"./selectBox.vue_vue_type_style_index_0_scoped_82c14c6c_lang-f1c14f73.js";import{E as Ae}from"./index-a6355ec2.js";import"./index-da53d962.js";import"./strings-fbdcd853.js";import"./isEqual-fe47b28a.js";import"./_Uint8Array-c7447712.js";import"./debounce-e2bc871f.js";import"./index-e8e7f773.js";import"./index-01b2a18b.js";import"./index-222e6800.js";import"./flatten-36990bb8.js";import"./_baseFlatten-c80c9ba3.js";import"./_overRest-d3d6b67b.js";import"./_baseClone-e7eb389f.js";import"./isArrayLikeObject-724a27ce.js";import"./employeesDialog-54936475.js";import"./selectBox-26a3a753.js";/* empty css                  *//* empty css                */import"./_plugin-vue_export-helper-c27b6911.js";import"./index-85bc974f.js";import"./index-a7c7b111.js";import"./flow-165b4256.js";import"./const-a11e1fef.js";import"./selectResult-4abbf083.js";/* empty css                                                                     *//* empty css                                                                        */import"./use-dialog-27a1e524.js";import"./refs-5fd04da2.js";import"./orgItem-a67c9471.js";const Ke={class:"app-container"},Me={class:"search"},Pe={class:"dialog-footer"},Pt=se({name:"Dept",inheritAttrs:!1,__name:"index",setup(je){u(!1);const{proxy:K}=ie(),V=pe({get(){return K.$isNotBlank(o.leaderName)?[{id:o.leaderUserId,name:o.leaderName,avatar:o.leaderAvatar,type:"user"}]:[]},set(n){o.leaderName=n[0].name,o.leaderUserId=n[0].id,o.leaderAvatar=n[0].avatar}}),x=u(D),y=u(D),c=u(!1),N=u([]),d=k({visible:!1}),f=k({}),U=u(),B=u(),o=k({status:1,parentId:0,sort:1}),M=k({parentId:[{required:!0,message:"上级部门不能为空",trigger:"blur"}],name:[{required:!0,message:"部门名称不能为空",trigger:"blur"}],sort:[{required:!0,message:"显示排序不能为空",trigger:"blur"}],leaderName:[{required:!0,message:"请选择部门负责人",trigger:"blur"}]});function g(){c.value=!0,A(f).then(({data:n})=>{U.value=n,c.value=!1})}function F(){x.value.resetFields(),g()}function P(n){N.value=n.map(l=>l.id)}async function j(){A().then(n=>{B.value=n.data})}async function q(n,l,h){await j(),d.visible=!0,l?(d.title="修改部门",Object.assign(o,h)):(d.title="新增部门",o.parentId=n??0,Object.assign(o,{}))}function z(){y.value.validate(n=>{if(n){const l=o.id;c.value=!0,l?Oe(l,o).then(()=>{E.success("修改成功"),b(),g()}).finally(()=>c.value=!1):Se(o).then(()=>{E.success("新增成功"),b(),g()}).finally(()=>c.value=!1)}})}function Q(n){const l=[n||N.value].join(",");if(!l){E.warning("请勾选删除项");return}ge.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{$e(l).then(()=>{E.success("删除成功"),F()})})}function b(){d.visible=!1,G()}function G(){y.value.resetFields(),y.value.clearValidate(),o.id=void 0,o.parentId=0,o.status=1,o.sort=1}return de(()=>{g()}),(n,l)=>{const h=ve,i=Te,R=Ve,H=Ce,J=Ue,m=ye,W=Be,T=D,v=xe,L=Ee,X=Re,Y=qe,Z=Fe,ee=Ne,te=De,oe=Ie,le=we,O=he,ae=ke,re=Ae,C=me("hasPerm"),ne=be;return p(),ue("div",Ke,[$("div",Me,[e(T,{ref_key:"queryFormRef",ref:x,model:r(f),inline:!0},{default:t(()=>[e(i,{label:"关键字",prop:"keywords"},{default:t(()=>[e(h,{modelValue:r(f).keywords,"onUpdate:modelValue":l[0]||(l[0]=a=>r(f).keywords=a),placeholder:"部门名称",onKeyup:_e(g,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),e(i,{label:"部门状态",prop:"status"},{default:t(()=>[e(H,{modelValue:r(f).status,"onUpdate:modelValue":l[1]||(l[1]=a=>r(f).status=a),placeholder:"部门状态",clearable:""},{default:t(()=>[e(R,{value:1,label:"正常"}),e(R,{value:0,label:"禁用"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(m,{class:"filter-item",type:"primary",onClick:g},{default:t(()=>[e(J),s(" 搜索 ")]),_:1}),e(m,{onClick:F},{default:t(()=>[e(W),s(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),e(te,null,{default:t(()=>[w((p(),_(ee,{data:U.value,"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"},onSelectionChange:P},{default:t(()=>[e(v,{type:"selection",width:"55",align:"center"}),e(v,{prop:"name",label:"部门名称","min-width":"200"}),e(v,{prop:"leaderName",label:"部门主管","min-width":"200"}),e(v,{prop:"status",label:"状态",width:"100"},{default:t(a=>[a.row.status==1?(p(),_(L,{key:0,type:"success"},{default:t(()=>[s("正常")]),_:1})):(p(),_(L,{key:1,type:"info"},{default:t(()=>[s("禁用")]),_:1}))]),_:1}),e(v,{prop:"sort",label:"排序",width:"100"}),e(v,{label:"操作",fixed:"right",align:"left",width:"200"},{default:t(a=>[w((p(),_(m,{type:"primary",link:"",size:"small",onClick:I(S=>q(a.row.id,void 0),["stop"])},{default:t(()=>[e(X),s(" 新增 ")]),_:2},1032,["onClick"])),[[C,["sys:dept:add"]]]),w((p(),_(m,{type:"primary",link:"",size:"small",onClick:I(S=>q(a.row.parentId,a.row.id,a.row),["stop"])},{default:t(()=>[e(Y),s(" 编辑 ")]),_:2},1032,["onClick"])),[[C,["sys:dept:edit"]]]),w((p(),_(m,{type:"primary",link:"",size:"small",onClick:I(S=>Q(a.row.id),["stop"])},{default:t(()=>[e(Z),s(" 删除 ")]),_:2},1032,["onClick"])),[[C,["sys:dept:delete"]]])]),_:1})]),_:1},8,["data"])),[[ne,c.value]])]),_:1}),e(re,{modelValue:r(d).visible,"onUpdate:modelValue":l[7]||(l[7]=a=>r(d).visible=a),title:r(d).title,width:"600px",onClosed:b},{footer:t(()=>[$("div",Pe,[e(m,{type:"primary",onClick:z},{default:t(()=>[s(" 确 定")]),_:1}),e(m,{onClick:b},{default:t(()=>[s(" 取 消")]),_:1})])]),default:t(()=>[e(T,{ref_key:"deptFormRef",ref:y,model:r(o),rules:r(M),"label-width":"120px"},{default:t(()=>[r(o).parentId===void 0||r(o).parentId>0?(p(),_(i,{key:0,label:"上级部门",prop:"parentId"},{default:t(()=>[e(oe,{modelValue:r(o).parentId,"onUpdate:modelValue":l[2]||(l[2]=a=>r(o).parentId=a),placeholder:"选择上级部门",data:B.value,props:{label:"name",value:"id"},filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1})):ce("",!0),e(i,{label:"部门名称",prop:"name"},{default:t(()=>[e(h,{modelValue:r(o).name,"onUpdate:modelValue":l[3]||(l[3]=a=>r(o).name=a),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"部门负责人",prop:"leaderName"},{default:t(()=>[e(Le,{disabled:!1,orgList:r(V),"onUpdate:orgList":l[4]||(l[4]=a=>fe(V)?V.value=a:null),type:"user",multiple:!1},null,8,["orgList"])]),_:1}),e(i,{label:"显示排序",prop:"sort"},{default:t(()=>[e(le,{modelValue:r(o).sort,"onUpdate:modelValue":l[5]||(l[5]=a=>r(o).sort=a),"controls-position":"right",style:{width:"100px"},min:0},null,8,["modelValue"])]),_:1}),e(i,{label:"部门状态"},{default:t(()=>[e(ae,{modelValue:r(o).status,"onUpdate:modelValue":l[6]||(l[6]=a=>r(o).status=a)},{default:t(()=>[e(O,{label:1},{default:t(()=>[s("正常")]),_:1}),e(O,{label:0},{default:t(()=>[s("禁用")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Pt as default};
