import{d as Y,r as M,o as A,a as T,c as R,k as m,a5 as h,w as p,a3 as _,ae as S,f as U,am as F,a7 as B,aD as N,ag as V,ah as P}from"./index-d5547550.js";import{u as x}from"./index-15f47425.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";const W=l=>(V("data-v-510f9aab"),l=l(),P(),l),j={class:"canvas-dom"},q=W(()=>m("h3",null,"基于canvas实现的签名组件",-1)),z=["onMousemove","onTouchmove"],G=["src"],H=Y({__name:"signature",setup(l){const i=M(""),a=M();let u,r=!1;const v=e=>{let t;if(e.offsetX){const{offsetX:o,offsetY:s}=e;t=[o,s]}else{const{top:o,left:s}=a.value.getBoundingClientRect(),n=e.touches[0].clientX-s,c=e.touches[0].clientY-o;t=[n,c]}return t};let d=0,f=0;const g=e=>{[d,f]=v(e),r=!0},w=e=>{if(r){const[t,o]=v(e);L(d,f,t,o,u),d=t,f=o}},k=()=>{r&&(r=!1)};A(()=>{u=a.value.getContext("2d")});const X=async()=>{if(C(a.value)){B({type:"warning",message:"当前签名文件为空"});return}const e=I(a.value.toDataURL(),"签名.png");if(!e)return;const{data:t}=await x(e);y(),i.value=t.url},y=()=>{u.clearRect(0,0,a.value.width,a.value.height)},C=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},D=()=>{if(C(a.value)){B({type:"warning",message:"当前签名文件为空"});return}const e=document.createElement("a");e.href=a.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},I=(e,t)=>{var b;const o=e.split(",");if(!o.length)return;const s=(b=o[0])==null?void 0:b.match(/:(.*?);/)[1],n=atob(o[1]);let c=n.length;const E=new Uint8Array(c);for(;c--;)E[c]=n.charCodeAt(c);return new File([E],t,{type:s})};function L(e,t,o,s,n){n.beginPath(),n.globalAlpha=1,n.lineWidth=2,n.strokeStyle="#000",n.moveTo(e,t),n.lineTo(o,s),n.closePath(),n.stroke()}return(e,t)=>{const o=N;return T(),R("div",j,[q,m("header",null,[h(o,{type:"primary",onClick:D},{default:p(()=>[_("保存为图片")]),_:1}),h(o,{onClick:X},{default:p(()=>[_(" 保存到后端 ")]),_:1}),h(o,{onClick:y},{default:p(()=>[_(" 清空签名 ")]),_:1})]),m("canvas",{ref_key:"canvas",ref:a,height:"200",width:"500",onMousedown:g,onMousemove:S(w,["stop","prevent"]),onMouseup:k,onTouchstart:g,onTouchmove:S(w,["stop","prevent"]),onTouchend:k},null,40,z),U(i)?(T(),R("img",{key:0,src:U(i),alt:"签名"},null,8,G)):F("",!0)])}}});const Z=O(H,[["__scopeId","data-v-510f9aab"]]);export{Z as default};
