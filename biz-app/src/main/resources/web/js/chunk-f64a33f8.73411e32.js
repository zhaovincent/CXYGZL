(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f64a33f8"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"24fd":function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return r}));var i=s("0c6d");function a(e){return Object(i["a"])({url:"org/tree",method:"get",params:e})}function n(e){return Object(i["a"])({url:"org/treeAll",method:"get",params:e})}function r(e){return Object(i["a"])({url:"org/tree/user/search",method:"get",params:e})}},"69ff":function(e,t,s){},"709c":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("w-dialog",{attrs:{border:!1,closeFree:"",width:"600px",title:e.title},on:{ok:e.selectOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"picker"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"candidate"},["role"!==e.type?s("div",[s("el-input",{staticStyle:{width:"95%"},attrs:{size:"small",clearable:"",placeholder:"搜索人员，支持拼音、姓名","prefix-icon":"el-icon-search"},on:{input:e.searchUser},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.showUsers,expression:"!showUsers"}]},[s("ellipsis",{staticStyle:{height:"18px",color:"#8c8c8c",padding:"5px 0 0"},attrs:{hoverTip:"",row:1,content:e.deptStackStr}},[s("i",{staticClass:"el-icon-office-building",attrs:{slot:"pre"},slot:"pre"})]),s("div",{staticStyle:{"margin-top":"5px"}},[s("el-checkbox",{attrs:{disabled:!e.multiple},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.deptStack.length>0,expression:"deptStack.length > 0"}],staticClass:"top-dept",on:{click:e.beforeNode}},[e._v("上一级")])],1)],1)],1):s("div",{staticClass:"role-header"},[s("div",[e._v("系统角色")])]),s("div",{staticClass:"org-items",style:"role"===e.type?"height: 350px":""},[s("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.orgs.length,expression:"orgs.length === 0"}],attrs:{"image-size":100,description:"似乎没有数据"}}),e._l(e.orgs,(function(t,i){return s("div",{key:i,class:e.orgItemClass(t),on:{click:function(s){return e.selectChange(t)}}},[s("el-checkbox",{attrs:{disabled:e.disableDept(t)},model:{value:t.selected,callback:function(s){e.$set(t,"selected",s)},expression:"org.selected"}}),"dept"===t.type?s("div",[s("i",{staticClass:"el-icon-folder-opened"}),s("span",{staticClass:"name"},[e._v(e._s(t.name))]),s("span",{class:"next-dept"+(t.selected?"-disable":""),on:{click:function(s){return s.stopPropagation(),e.nextNode(t)}}},[s("i",{staticClass:"iconfont icon-map-site"}),e._v("下级 ")])]):"user"===t.type?s("div",{staticStyle:{display:"flex","align-items":"center"}},[e.$isNotEmpty(t.avatar)?s("el-avatar",{attrs:{size:35,src:t.avatar}}):s("span",{staticClass:"avatar"},[e._v(e._s(e.getShortName(t.name)))]),s("span",{staticClass:"name"},[e._v(e._s(t.name))])],1):s("div",{staticStyle:{display:"inline-block"}},[s("i",{staticClass:"iconfont icon-bumen"}),s("span",{staticClass:"name"},[e._v(e._s(t.name))])])],1)}))],2)]),s("div",{staticClass:"selected"},[s("div",{staticClass:"count"},[s("span",[e._v("已选 "+e._s(e.select.length)+" 项")]),s("span",{on:{click:e.clearSelected}},[e._v("清空")])]),s("div",{staticClass:"org-items",staticStyle:{height:"350px"}},[s("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.select.length,expression:"select.length === 0"}],attrs:{"image-size":100,description:"请点击左侧列表选择数据"}}),e._l(e.select,(function(t,i){return s("div",{key:i,class:e.orgItemClass(t)},["dept"===t.type?s("div",[s("i",{staticClass:"el-icon-folder-opened"}),s("span",{staticClass:"name",staticStyle:{position:"static"}},[e._v(e._s(t.name))])]):"user"===t.type?s("div",{staticStyle:{display:"flex","align-items":"center"}},[e.$isNotEmpty(t.avatar)?s("el-avatar",{attrs:{size:35,src:t.avatar}}):s("span",{staticClass:"avatar"},[e._v(e._s(e.getShortName(t.name)))]),s("span",{staticClass:"name"},[e._v(e._s(t.name))])],1):s("div",[s("i",{staticClass:"iconfont icon-bumen"}),s("span",{staticClass:"name"},[e._v(e._s(t.name))])]),s("i",{staticClass:"el-icon-close",on:{click:function(t){return e.noSelected(i)}}})])}))],2)])])])},a=[],n=(s("4160"),s("d81d"),s("a434"),s("b0c0"),s("ac1f"),s("841c"),s("498a"),s("159b"),s("24fd")),r={name:"OrgPicker",components:{},props:{title:{default:"请选择",type:String},type:{default:"org",type:String},multiple:{default:!1,type:Boolean},selected:{default:function(){return[]},type:Array}},mounted:function(){},data:function(){return{visible:!1,loading:!1,checkAll:!1,nowDeptId:null,isIndeterminate:!1,searchUsers:[],nodes:[],select:[],search:"",deptStack:[]}},computed:{deptStackStr:function(){return String(this.deptStack.map((function(e){return e.name}))).replaceAll(","," > ")},orgs:function(){return this.search&&""!==this.search.trim()?this.searchUsers:this.nodes},showUsers:function(){return this.search||""!==this.search.trim()}},methods:{show:function(){this.visible=!0,this.init(),this.getOrgList()},orgItemClass:function(e){return{"org-item":!0,"org-dept-item":"dept"===e.type,"org-user-item":"user"===e.type,"org-role-item":"role"===e.type}},disableDept:function(e){return"user"===this.type&&"dept"===e.type},getOrgList:function(){var e=this;this.loading=!0,Object(n["a"])({deptId:this.nowDeptId,type:this.type}).then((function(t){e.loading=!1,e.nodes=t.data,e.selectToLeft()})).catch((function(t){e.loading=!1,e.$message.error(t.response.data)}))},getShortName:function(e){return e?e.length>2?e.substring(1,3):e:"**"},searchUser:function(){var e=this,t=this.search.trim();this.searchUsers=[],this.loading=!0,Object(n["c"])({userName:t}).then((function(t){e.loading=!1,e.searchUsers=t.data,e.selectToLeft()})).catch((function(t){e.loading=!1,e.$message.error("接口异常")}))},selectToLeft:function(){var e=this,t=""===this.search.trim()?this.nodes:this.searchUsers;t.forEach((function(t){for(var s=0;s<e.select.length;s++){if(e.select[s].id===t.id&&e.select[s].type===t.type){t.selected=!0;break}t.selected=!1}}))},selectChange:function(e){if(e.selected){this.checkAll=!1;for(var t=0;t<this.select.length;t++)if(this.select[t].id===e.id){this.select.splice(t,1);break}e.selected=!1}else if(!this.disableDept(e)){e.selected=!0;var s=""===this.search.trim()?this.nodes:this.searchUsers;this.multiple||s.forEach((function(t){e.id!==t.id&&(t.selected=!1)})),"dept"===e.type?this.multiple?this.select.unshift(e):this.select=[e]:this.multiple?this.select.push(e):this.select=[e]}},noSelected:function(e){for(var t=this.nodes,s=0;s<2;s++){for(var i=0;i<t.length;i++)if(t[i].id===this.select[e].id){t[i].selected=!1,this.checkAll=!1;break}t=this.searchUsers}this.select.splice(e,1)},handleCheckAllChange:function(){var e=this;this.nodes.forEach((function(t){if(e.checkAll)t.selected||e.disableDept(t)||(t.selected=!0,e.select.push(t));else{t.selected=!1;for(var s=0;s<e.select.length;s++)if(e.select[s].id===t.id){e.select.splice(s,1);break}}}))},nextNode:function(e){this.nowDeptId=e.id,this.deptStack.push(e),this.getOrgList()},beforeNode:function(){0!==this.deptStack.length&&(this.deptStack.length<2?this.nowDeptId=null:this.nowDeptId=this.deptStack[this.deptStack.length-2].id,this.deptStack.splice(this.deptStack.length-1,1),this.getOrgList())},recover:function(){this.select=[],this.nodes.forEach((function(e){return e.selected=!1}))},selectOk:function(){this.$emit("ok",Object.assign([],this.select.map((function(e){return e})))),this.visible=!1,this.recover()},clearSelected:function(){var e=this;this.$confirm("您确定要清空已选中的项?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.recover()}))},close:function(){this.$emit("close"),this.recover()},init:function(){this.checkAll=!1,this.nowDeptId=null,this.deptStack=[],this.nodes=[],this.select=Object.assign([],this.selected),this.selectToLeft()}}},l=r,o=(s("75ab"),s("2877")),c=Object(o["a"])(l,i,a,!1,null,"1cfdb70e",null);t["a"]=c.exports},"75ab":function(e,t,s){"use strict";var i=s("69ff"),a=s.n(i);a.a},"841c":function(e,t,s){"use strict";var i=s("d784"),a=s("825a"),n=s("1d80"),r=s("129f"),l=s("14c3");i("search",1,(function(e,t,s){return[function(t){var s=n(this),i=void 0==t?void 0:t[e];return void 0!==i?i.call(t,s):new RegExp(t)[e](String(s))},function(e){var i=s(t,e,this);if(i.done)return i.value;var n=a(e),o=String(this),c=n.lastIndex;r(c,0)||(n.lastIndex=0);var d=l(n,o);return r(n.lastIndex,c)||(n.lastIndex=c),null===d?-1:d.index}]}))},d07e:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"id",border:"","default-expand-all":"",stripe:"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[s("el-table-column",{attrs:{prop:"name",label:"部门",width:"180"}}),s("el-table-column",{attrs:{prop:"leaderName",label:"主管",width:"180"}}),s("el-table-column",{attrs:{prop:"address",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.showAddDialg(t.row)}}},[e._v("添加子部门")]),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return e.showEditDialg(t.row)}}},[e._v("编辑")]),s("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"这是一段内容确定删除吗？"},on:{confirm:function(s){return e.deleteOrg(t.row)}}},[s("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),s("org-picker",{ref:"orgPicker",attrs:{title:"选择部门主管",type:"user",selected:e.orgPickerSelected},on:{ok:e.selected}}),s("el-dialog",{attrs:{"destroy-on-close":"",center:"",title:e.dialogTitle,visible:e.dialogFormVisible},on:{closed:e.beforeCloseDialog,"update:visible":function(t){e.dialogFormVisible=t}}},[s("el-form",{attrs:{model:e.form}},[e.tableData.length>0?s("el-form-item",{attrs:{label:"父级部门","label-width":e.formLabelWidth}},[s("el-cascader",{staticStyle:{width:"70%"},attrs:{filterable:"",props:e.tableProps,options:e.tableData,"show-all-levels":!1},model:{value:e.form.parent,callback:function(t){e.$set(e.form,"parent",t)},expression:"form.parent"}})],1):e._e(),s("el-form-item",{attrs:{label:"部门名称","label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"70%"},attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:"部门主管","label-width":e.formLabelWidth}},[s("el-input",{staticStyle:{width:"70%"},attrs:{readonly:"",autocomplete:"off"},model:{value:e.form.leader.name,callback:function(t){e.$set(e.form.leader,"name",t)},expression:"form.leader.name"}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.showSelectUser}},[e._v("选择人员")])],1)],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.createDep}},[e._v("确 定")])],1)],1)],1)},a=[],n=(s("4160"),s("fb6a"),s("b0c0"),s("159b"),s("24fd")),r=s("0c6d");function l(e){return Object(r["a"])({url:"dept/create",method:"post",data:e})}function o(e){return Object(r["a"])({url:"dept/update",method:"put",data:e})}function c(e){return Object(r["a"])({url:"dept/delete",method:"delete",data:e})}var d=s("709c"),h={name:"index",components:{OrgPicker:d["a"]},data:function(){return{dialogTitle:"",operFlag:1,tableProps:{value:"id",label:"name",checkStrictly:!0},orgPickerSelected:[],dialogFormVisible:!1,form:{name:"",leader:{},parent:[]},formLabelWidth:"120px",tableData:[]}},watch:{orgPickerSelected:function(e){e.length>0&&(this.form.leader=e[0])}},mounted:function(){this.getData()},methods:{beforeCloseDialog:function(){this.form={name:"",id:void 0,parent:[],leader:{}},this.orgPickerSelected=[]},deleteOrg:function(e){var t=this,s=this;c(e).then((function(e){t.$message.success(e.data),s.getData()})).catch((function(e){t.$message.error(e.response.data)}))},getData:function(){var e=this,t=this;Object(n["b"])({deptId:0,isDept:!0}).then((function(e){t.tableData=e.data})).catch((function(t){e.$message.error(t.response.data)}))},showEditDialg:function(e){this.operFlag=2,this.dialogTitle=" 修改部门",console.log(e),this.form.parent=e.roodIdList.slice(0,e.roodIdList.length-1),this.form.name=e.name,this.form.id=e.id,this.form.leader={id:e.leaderId,name:e.leaderName},this.dialogFormVisible=!0},showAddDialg:function(e){this.operFlag=1,this.dialogTitle="添加部门",this.form.parent=e.roodIdList,this.dialogFormVisible=!0},createDep:function(){var e=this,t=this,s={name:this.form.name,parentId:this.form.parent[this.form.parent.length-1],leaderUserId:this.form.leader.id,id:this.form.id};console.log(this.form),1==this.operFlag&&l(s).then((function(s){e.$message.success(s.data),t.getData(),t.dialogFormVisible=!1})).catch((function(t){e.$message.error(t.response.data)})),2==this.operFlag&&o(s).then((function(s){e.$message.success(s.data),t.getData(),t.dialogFormVisible=!1})).catch((function(t){e.$message.error(t.response.data)}))},showSelectUser:function(){this.$refs.orgPicker.show()},selected:function(e){var t=this;this.orgPickerSelected.length=0,e.forEach((function(e){return t.orgPickerSelected.push(e)}))}}},u=h,p=s("2877"),f=Object(p["a"])(u,i,a,!1,null,"2750bf40",null);t["default"]=f.exports},d81d:function(e,t,s){"use strict";var i=s("23e7"),a=s("b727").map,n=s("1dde"),r=s("ae40"),l=n("map"),o=r("map");i({target:"Array",proto:!0,forced:!l||!o},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-f64a33f8.73411e32.js.map